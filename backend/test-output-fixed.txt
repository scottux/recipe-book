
> recipe-book-backend@2.2.2 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --forceExit

‚úì MongoDB Memory Server started
  URI: mongodb://127.0.0.1:27017/?replicaSet=testset
(node:64158) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL src/__tests__/integration/email-verification.test.js (183.762 s)
  Email Verification Integration Tests
    POST /api/auth/register
      ‚úï should create user with emailVerified=false by default (10007 ms)
    GET /api/auth/me
      ‚úï should include emailVerified status (10002 ms)
    POST /api/auth/send-verification
      ‚úï should send verification email for authenticated user (10002 ms)
      ‚úï should fail without authentication (10003 ms)
      ‚úï should fail if email already verified (10003 ms)
      ‚úï should enforce rate limiting (3 requests per hour) (10002 ms)
    GET /api/auth/verify-email/:token
      ‚úï should verify email with valid token (10001 ms)
      ‚úï should fail with invalid token (10003 ms)
      ‚úï should fail with expired token (10004 ms)
      ‚úï should fail if email already verified (10003 ms)
      ‚úï should invalidate token after successful verification (10003 ms)
    Token Security
      ‚úï should hash verification tokens in database (10003 ms)
      ‚úï should generate unique tokens for each request (10006 ms)
    Token Expiration
      ‚úï should set expiration to 24 hours from creation (10003 ms)
    User Model - cleanupExpiredTokens
      ‚úï should remove expired verification tokens (10003 ms)
      ‚úï should not remove valid tokens (10001 ms)
    Security - Timing Attacks
      ‚úï should take similar time for valid and invalid tokens (10003 ms)
    Integration with Registration Flow
      ‚úï should complete full registration and verification flow (10003 ms)

  ‚óè Email Verification Integration Tests ‚Ä∫ POST /api/auth/register ‚Ä∫ should create user with emailVerified=false by default

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ GET /api/auth/me ‚Ä∫ should include emailVerified status

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ POST /api/auth/send-verification ‚Ä∫ should send verification email for authenticated user

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ POST /api/auth/send-verification ‚Ä∫ should fail without authentication

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ POST /api/auth/send-verification ‚Ä∫ should fail if email already verified

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ POST /api/auth/send-verification ‚Ä∫ should enforce rate limiting (3 requests per hour)

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ GET /api/auth/verify-email/:token ‚Ä∫ should verify email with valid token

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ GET /api/auth/verify-email/:token ‚Ä∫ should fail with invalid token

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ GET /api/auth/verify-email/:token ‚Ä∫ should fail with expired token

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ GET /api/auth/verify-email/:token ‚Ä∫ should fail if email already verified

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ GET /api/auth/verify-email/:token ‚Ä∫ should invalidate token after successful verification

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ Token Security ‚Ä∫ should hash verification tokens in database

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ Token Security ‚Ä∫ should generate unique tokens for each request

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ Token Expiration ‚Ä∫ should set expiration to 24 hours from creation

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ User Model - cleanupExpiredTokens ‚Ä∫ should remove expired verification tokens

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ User Model - cleanupExpiredTokens ‚Ä∫ should not remove valid tokens

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ Security - Timing Attacks ‚Ä∫ should take similar time for valid and invalid tokens

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè Email Verification Integration Tests ‚Ä∫ Integration with Registration Flow ‚Ä∫ should complete full registration and verification flow

    MongooseError: Operation `users.deleteMany()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:29:50.210 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:29:50.306 [[32minfo[39m]: POST /login 200 97ms {"requestId":"f1d52f7b-a453-4713-af4b-d531c56a195b","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":97,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":711}
FAIL src/__tests__/integration/meal-planning.test.js
  Meal Planning API Integration Tests
    POST /api/meal-plans
      ‚úï should create a new meal plan (2 ms)
      ‚úï should reject meal plans longer than 28 days (5 ms)
      ‚úï should detect overlapping meal plans (2 ms)
      ‚úï should require authentication (11 ms)
    GET /api/meal-plans
      ‚úï should get all meal plans for authenticated user
      ‚úï should filter templates when requested (3 ms)
    POST /api/meal-plans/:id/meals
      ‚úï should add a meal to the plan (1 ms)
      ‚úï should reject invalid recipe ID (1 ms)
      ‚úï should add multiple recipes to same meal
    DELETE /api/meal-plans/:id/meals/:mealId
      ‚úï should remove a meal from the plan (1 ms)
      ‚úï should return 404 for non-existent meal (2 ms)
    GET /api/meal-plans/:id/shopping-list
      ‚úï should generate shopping list from meal plan (3 ms)
    POST /api/meal-plans/:id/duplicate
      ‚úï should duplicate as template (9 ms)
      ‚úï should duplicate to new dates (1 ms)
      ‚úï should reject duplicate if dates overlap (4 ms)
    DELETE /api/meal-plans/:id
      ‚úï should delete a meal plan (1 ms)
      ‚úï should not allow deleting other users meal plans
    PUT /api/meal-plans/:id
      ‚úï should update meal plan details (1 ms)
      ‚úï should detect overlaps when updating dates (3 ms)

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans ‚Ä∫ should create a new meal plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans ‚Ä∫ should reject meal plans longer than 28 days

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans ‚Ä∫ should detect overlapping meal plans

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans ‚Ä∫ should require authentication

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ GET /api/meal-plans ‚Ä∫ should get all meal plans for authenticated user

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ GET /api/meal-plans ‚Ä∫ should filter templates when requested

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans/:id/meals ‚Ä∫ should add a meal to the plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans/:id/meals ‚Ä∫ should reject invalid recipe ID

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans/:id/meals ‚Ä∫ should add multiple recipes to same meal

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ DELETE /api/meal-plans/:id/meals/:mealId ‚Ä∫ should remove a meal from the plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ DELETE /api/meal-plans/:id/meals/:mealId ‚Ä∫ should return 404 for non-existent meal

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ GET /api/meal-plans/:id/shopping-list ‚Ä∫ should generate shopping list from meal plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans/:id/duplicate ‚Ä∫ should duplicate as template

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans/:id/duplicate ‚Ä∫ should duplicate to new dates

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ POST /api/meal-plans/:id/duplicate ‚Ä∫ should reject duplicate if dates overlap

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ DELETE /api/meal-plans/:id ‚Ä∫ should delete a meal plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ DELETE /api/meal-plans/:id ‚Ä∫ should not allow deleting other users meal plans

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ PUT /api/meal-plans/:id ‚Ä∫ should update meal plan details

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Meal Planning API Integration Tests ‚Ä∫ PUT /api/meal-plans/:id ‚Ä∫ should detect overlaps when updating dates

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL src/__tests__/integration/password-reset.test.js
  Password Reset Integration Tests
    POST /api/auth/forgot-password
      ‚úï should successfully request a password reset for existing user
      ‚úï should not reveal if email does not exist (security)
      ‚úï should reject invalid email format
      ‚úï should reject missing email
      ‚úï should handle rate limiting
    GET /api/auth/validate-reset-token
      ‚úï should validate a valid reset token
      ‚úï should reject invalid token format
      ‚úï should reject expired token
      ‚úï should reject token not in database
      ‚úï should reject missing token
    POST /api/auth/reset-password
      ‚úï should successfully reset password with valid token
      ‚úï should be able to login with new password
      ‚úï should not be able to use old password after reset
      ‚úï should reject weak password
      ‚úï should reject password without uppercase
      ‚úï should reject password without number
      ‚úï should reject invalid token
      ‚úï should reject expired token
      ‚úï should reject reusing the same token twice
      ‚úï should reject missing password
      ‚úï should reject missing token
    Complete Password Reset Flow
      ‚úï should complete entire password reset flow successfully (1 ms)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/forgot-password ‚Ä∫ should successfully request a password reset for existing user

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/forgot-password ‚Ä∫ should not reveal if email does not exist (security)

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/forgot-password ‚Ä∫ should reject invalid email format

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/forgot-password ‚Ä∫ should reject missing email

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/forgot-password ‚Ä∫ should handle rate limiting

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ GET /api/auth/validate-reset-token ‚Ä∫ should validate a valid reset token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ GET /api/auth/validate-reset-token ‚Ä∫ should reject invalid token format

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ GET /api/auth/validate-reset-token ‚Ä∫ should reject expired token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ GET /api/auth/validate-reset-token ‚Ä∫ should reject token not in database

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ GET /api/auth/validate-reset-token ‚Ä∫ should reject missing token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should successfully reset password with valid token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should be able to login with new password

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should not be able to use old password after reset

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject weak password

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject password without uppercase

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject password without number

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject invalid token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject expired token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject reusing the same token twice

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject missing password

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject missing token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  ‚óè Password Reset Integration Tests ‚Ä∫ Complete Password Reset Flow ‚Ä∫ should complete entire password reset flow successfully

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:29:55.040 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:29:55.119 [[32minfo[39m]: POST /login 200 79ms {"requestId":"36eae548-bdf4-4f7e-b5a2-835022dc2feb","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":713}
2026-02-17 11:29:55.128 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.138 [[33mwarn[39m]: POST /backup 400 9ms {"requestId":"22209a54-9ab9-407c-8a21-95b19aea975d","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":9,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":4,"limit":5},"responseSize":102}
2026-02-17 11:29:55.145 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.149 [[31merror[39m]: Request error {"requestId":"e15b3734-830c-49c3-8136-1ede4ead4ee6","error":"Must be .json file","stack":"ImportError: Must be .json file\n    at fileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/importController.js:36:9)\n    at wrappedFileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/index.js:44:7)\n    at Multipart.<anonymous> (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/lib/make-middleware.js:109:7)\n    at Multipart.emit (node:events:507:28)\n    at HeaderParser.cb (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:358:14)\n    at HeaderParser.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:162:20)\n    at SBMH.ssCb [as _cb] (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:394:37)\n    at feed (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:219:14)\n    at SBMH.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:104:16)\n    at Multipart._write (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:567:19)\n    at writeOrBuffer (node:internal/streams/writable:570:12)\n    at _write (node:internal/streams/writable:499:10)\n    at Multipart.Writable.write (node:internal/streams/writable:508:10)\n    at IncomingMessage.ondata (node:internal/streams/readable:1008:24)\n    at IncomingMessage.emit (node:events:507:28)\n    at IncomingMessage.Readable.read (node:internal/streams/readable:780:10)\n    at flow (node:internal/streams/readable:1286:53)\n    at resume_ (node:internal/streams/readable:1265:3)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","method":"POST","path":"/api/import/backup","userId":"6994978276fb010d99c864cd","ip":"::ffff:127.0.0.1"}
2026-02-17 11:29:55.150 [[31merror[39m]: Unhandled error {"requestId":"e15b3734-830c-49c3-8136-1ede4ead4ee6","error":"Must be .json file","stack":"ImportError: Must be .json file\n    at fileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/importController.js:36:9)\n    at wrappedFileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/index.js:44:7)\n    at Multipart.<anonymous> (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/lib/make-middleware.js:109:7)\n    at Multipart.emit (node:events:507:28)\n    at HeaderParser.cb (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:358:14)\n    at HeaderParser.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:162:20)\n    at SBMH.ssCb [as _cb] (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:394:37)\n    at feed (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:219:14)\n    at SBMH.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:104:16)\n    at Multipart._write (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:567:19)\n    at writeOrBuffer (node:internal/streams/writable:570:12)\n    at _write (node:internal/streams/writable:499:10)\n    at Multipart.Writable.write (node:internal/streams/writable:508:10)\n    at IncomingMessage.ondata (node:internal/streams/readable:1008:24)\n    at IncomingMessage.emit (node:events:507:28)\n    at IncomingMessage.Readable.read (node:internal/streams/readable:780:10)\n    at flow (node:internal/streams/readable:1286:53)\n    at resume_ (node:internal/streams/readable:1265:3)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","path":"/api/import/backup","method":"POST"}
2026-02-17 11:29:55.150 [[31merror[39m]: POST /api/import/backup 500 5ms {"requestId":"e15b3734-830c-49c3-8136-1ede4ead4ee6","method":"POST","path":"/api/import/backup","url":"/api/import/backup","statusCode":500,"duration":5,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":3,"limit":5},"responseSize":1969}
2026-02-17 11:29:55.159 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.162 [[33mwarn[39m]: POST /backup 400 3ms {"requestId":"d76248bd-0993-4981-8faa-68094811f377","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":2,"limit":5},"responseSize":133}
2026-02-17 11:29:55.167 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.168 [[33mwarn[39m]: POST /backup 400 2ms {"requestId":"ca91406a-d07b-45ac-a854-f6e1ff320d16","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":1,"limit":5},"responseSize":195}
2026-02-17 11:29:55.173 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.176 [[33mwarn[39m]: POST /backup 400 3ms {"requestId":"5cb4cf99-51cc-4f78-b40d-67a7cb030181","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":205}
2026-02-17 11:29:55.181 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.183 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"6c9fa664-6cca-418f-b87f-5a279787deac","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.188 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.190 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"3a6c8f43-0723-422b-a41e-031a23e83c76","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.194 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.196 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"8f83f9b8-e206-43fb-863f-720880f95855","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.200 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.202 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"560f1482-3077-4b4d-9d3a-e2d06064fb31","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.219 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.220 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"3bed13a8-fe81-4306-9c09-eaa265f0d78d","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.225 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.227 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"23b73e30-807d-49d5-9944-6c7ed868f214","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.235 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.236 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"3b30d8d3-d917-4a18-bd3f-414a18482374","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.240 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.242 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"035ff56d-4af2-4c6b-9fc7-ae08a086903d","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.246 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.247 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"3d405ab9-b74b-4275-9aa9-be35f019b2d5","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.252 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.254 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"26f8f437-7cc6-4ee3-8d32-2e0589e10a63","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.258 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.258 [[33mwarn[39m]: POST /backup 401 0ms {"requestId":"1abece03-72e2-47a8-88fc-0abf9f1c3411","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:29:55.263 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.266 [[33mwarn[39m]: POST /backup 429 3ms {"requestId":"b2f00b15-8df7-4e8d-930a-ed189ec51468","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":3,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:29:55.291 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:55.294 [[33mwarn[39m]: POST /backup 429 3ms {"requestId":"cdbdd7bf-8eab-4e8f-bd4c-ca78a918d275","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":3,"ip":"::ffff:127.0.0.1","userId":"6994978276fb010d99c864cd","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
FAIL src/__tests__/integration/import-backup.test.js
  Import from Backup - Integration Tests
    POST /api/import/backup - File Validation
      ‚úì should reject request with no file (18 ms)
      ‚úï should reject non-JSON file (14 ms)
      ‚úì should reject invalid JSON (9 ms)
      ‚úì should reject backup missing required fields (6 ms)
      ‚úì should reject incompatible version (< 2.0.0) (8 ms)
    POST /api/import/backup - Content Validation
      ‚úï should reject recipe missing title (7 ms)
      ‚úï should reject recipe with empty ingredients (6 ms)
      ‚úï should reject recipe with empty instructions (6 ms)
    POST /api/import/backup - Merge Mode
      ‚úï should successfully import backup in merge mode (7 ms)
      ‚úï should skip duplicates in merge mode (6 ms)
      ‚úï should preserve existing data in merge mode (3 ms)
    POST /api/import/backup - Replace Mode
      ‚úï should reject replace mode without password (7 ms)
      ‚úï should reject replace mode with wrong password (7 ms)
      ‚úï should delete all existing data in replace mode (3 ms)
    POST /api/import/backup - ID Remapping
      ‚úï should remap recipe IDs in collections (6 ms)
      ‚úï should remap recipe IDs in meal plans (6 ms)
      ‚úï should handle missing recipe references gracefully (5 ms)
    POST /api/import/backup - Transaction Rollback
      ‚úï should rollback on validation error (6 ms)
    POST /api/import/backup - Security
      ‚úì should require authentication (5 ms)
      ‚úï should sanitize XSS in recipe titles (18 ms)
    POST /api/import/backup - Performance
      ‚úï should complete import within reasonable time (23 ms)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - File Validation ‚Ä∫ should reject non-JSON file

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      159 |         .attach('file', Buffer.from('not json'), 'backup.txt');
      160 |
    > 161 |       expect(res.status).toBe(400);
          |                          ^
      162 |       expect(res.body.success).toBe(false);
      163 |     });
      164 |

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:161:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Content Validation ‚Ä∫ should reject recipe missing title

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      226 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      227 |
    > 228 |       expect(res.status).toBe(400);
          |                          ^
      229 |       expect(res.body.success).toBe(false);
      230 |       expect(res.body.details.code).toBe('INVALID_RECIPE');
      231 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:228:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Content Validation ‚Ä∫ should reject recipe with empty ingredients

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      252 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      253 |
    > 254 |       expect(res.status).toBe(400);
          |                          ^
      255 |       expect(res.body.success).toBe(false);
      256 |       expect(res.body.details.code).toBe('INVALID_RECIPE');
      257 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:254:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Content Validation ‚Ä∫ should reject recipe with empty instructions

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      278 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      279 |
    > 280 |       expect(res.status).toBe(400);
          |                          ^
      281 |       expect(res.body.success).toBe(false);
      282 |       expect(res.body.details.code).toBe('INVALID_RECIPE');
      283 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:280:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Merge Mode ‚Ä∫ should successfully import backup in merge mode

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      292 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      293 |
    > 294 |       expect(res.status).toBe(200);
          |                          ^
      295 |       expect(res.body.success).toBe(true);
      296 |       expect(res.body.summary).toMatchObject({
      297 |         mode: 'merge',

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:294:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Merge Mode ‚Ä∫ should skip duplicates in merge mode

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required., ingredients.2.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Merge Mode ‚Ä∫ should preserve existing data in merge mode

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Replace Mode ‚Ä∫ should reject replace mode without password

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      379 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      380 |
    > 381 |       expect(res.status).toBe(400);
          |                          ^
      382 |       expect(res.body.success).toBe(false);
      383 |       expect(res.body.details.code).toBe('INVALID_PASSWORD');
      384 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:381:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Replace Mode ‚Ä∫ should reject replace mode with wrong password

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      392 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      393 |
    > 394 |       expect(res.status).toBe(400);
          |                          ^
      395 |       expect(res.body.success).toBe(false);
      396 |       expect(res.body.details.code).toBe('INVALID_PASSWORD');
      397 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:394:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Replace Mode ‚Ä∫ should delete all existing data in replace mode

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - ID Remapping ‚Ä∫ should remap recipe IDs in collections

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      442 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      443 |
    > 444 |       expect(res.status).toBe(200);
          |                          ^
      445 |
      446 |       // Get imported collection
      447 |       const collection = await Collection.findOne({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:444:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - ID Remapping ‚Ä∫ should remap recipe IDs in meal plans

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      462 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      463 |
    > 464 |       expect(res.status).toBe(200);
          |                          ^
      465 |
      466 |       // Get imported meal plan
      467 |       const mealPlan = await MealPlan.findOne({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:464:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - ID Remapping ‚Ä∫ should handle missing recipe references gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      503 |         );
      504 |
    > 505 |       expect(res.status).toBe(200);
          |                          ^
      506 |
      507 |       // Collection should only have valid reference
      508 |       const collection = await Collection.findOne({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:505:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Transaction Rollback ‚Ä∫ should rollback on validation error

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      534 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      535 |
    > 536 |       expect(res.status).toBe(400);
          |                          ^
      537 |
      538 |       // Verify NO data was created (rollback successful)
      539 |       const recipes = await Recipe.find({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:536:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Security ‚Ä∫ should sanitize XSS in recipe titles

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      576 |         .attach('file', Buffer.from(JSON.stringify(xssBackup)), 'backup.json');
      577 |
    > 578 |       expect(res.status).toBe(200);
          |                          ^
      579 |
      580 |       const recipe = await Recipe.findOne({ owner: userId });
      581 |       expect(recipe.title).not.toContain('<script>');

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:578:26)

  ‚óè Import from Backup - Integration Tests ‚Ä∫ POST /api/import/backup - Performance ‚Ä∫ should complete import within reasonable time

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      596 |       const duration = Date.now() - startTime;
      597 |
    > 598 |       expect(res.status).toBe(200);
          |                          ^
      599 |       expect(duration).toBeLessThan(5000); // Should complete in < 5s
      600 |       expect(res.body.summary.duration).toBeLessThan(5000);
      601 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:598:26)

(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:29:57.706 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:29:57.787 [[32minfo[39m]: POST /login 200 81ms {"requestId":"137ef23f-7553-4c67-abe0-23edace67be0","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":81,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":718}
2026-02-17 11:29:57.790 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/dropbox/auth:::ffff:127.0.0.1"}
2026-02-17 11:29:57.794 [[32minfo[39m]: Dropbox OAuth initiated for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.794 [[32minfo[39m]: GET /dropbox/auth 200 4ms {"requestId":"6518cb86-a6f1-421a-b1ac-60d2e62f2db5","method":"GET","path":"/dropbox/auth","url":"/api/cloud/dropbox/auth","statusCode":200,"duration":4,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":255}
2026-02-17 11:29:57.797 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/dropbox/auth:::ffff:127.0.0.1"}
2026-02-17 11:29:57.798 [[33mwarn[39m]: GET /dropbox/auth 401 1ms {"requestId":"994fd49a-96d8-489d-ba61-17dd82b2518f","method":"GET","path":"/dropbox/auth","url":"/api/cloud/dropbox/auth","statusCode":401,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:29:57.801 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/status:::ffff:127.0.0.1"}
2026-02-17 11:29:57.807 [[32minfo[39m]: GET /status 200 6ms {"requestId":"dce2a493-7af5-48ed-a274-716d7050185c","method":"GET","path":"/status","url":"/api/cloud/status","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":50}
2026-02-17 11:29:57.815 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/status:::ffff:127.0.0.1"}
2026-02-17 11:29:57.820 [[32minfo[39m]: GET /status 200 5ms {"requestId":"612b5c3a-8fda-4d42-acf4-1bb1bc722f39","method":"GET","path":"/status","url":"/api/cloud/status","statusCode":200,"duration":5,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":427}
2026-02-17 11:29:57.829 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:57.836 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.837 [[32minfo[39m]: POST /disconnect 200 8ms {"requestId":"8c38fab5-6633-4c89-8d1a-2a2bae1f16b2","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":8,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:57.846 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:57.857 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.857 [[32minfo[39m]: POST /disconnect 200 11ms {"requestId":"09303fd0-4f7e-4180-ba64-890f299f7033","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":11,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:57.859 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:57.863 [[33mwarn[39m]: POST /disconnect 400 4ms {"requestId":"ea800222-c1bd-46ac-a6f9-2579ffa9616a","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":400,"duration":4,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:29:57.872 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:57.876 [[32minfo[39m]: Manual backup requested for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.876 [[32minfo[39m]: Generating manual backup for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.896 [[32minfo[39m]: Archive created: 293 bytes
2026-02-17 11:29:57.896 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-29-57.zip (293 bytes)
2026-02-17 11:29:57.904 [[32minfo[39m]: Cleaned up backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-29-57.zip
2026-02-17 11:29:57.904 [[32minfo[39m]: Manual backup successful for user 69949785e6b94d3cea2e2436: recipe-book-manual-backup-2026-02-16T15-00-00.zip
2026-02-17 11:29:57.904 [[32minfo[39m]: POST /backup 200 33ms {"requestId":"fdc73619-ee5d-46c6-85ee-73e511fb7214","method":"POST","path":"/backup","url":"/api/cloud/backup","statusCode":200,"duration":33,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":315}
2026-02-17 11:29:57.913 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:57.923 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.923 [[32minfo[39m]: POST /disconnect 200 10ms {"requestId":"36e7f96b-082a-47e6-a330-ae25a90f9eae","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":10,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:57.925 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backup:::ffff:127.0.0.1"}
2026-02-17 11:29:57.928 [[33mwarn[39m]: POST /backup 400 3ms {"requestId":"381ec0e3-b4ac-4107-b653-b7c188fb3098","method":"POST","path":"/backup","url":"/api/cloud/backup","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":104}
2026-02-17 11:29:57.934 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:57.943 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.944 [[32minfo[39m]: POST /disconnect 200 10ms {"requestId":"eb8dfca1-acaa-4eb3-ba59-9cdd617862d0","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":10,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:57.946 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups:::ffff:127.0.0.1"}
2026-02-17 11:29:57.948 [[32minfo[39m]: GET /backups 200 2ms {"requestId":"45608bea-095f-4d00-92d9-60426bd3e99c","method":"GET","path":"/backups","url":"/api/cloud/backups","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":39}
2026-02-17 11:29:57.956 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups:::ffff:127.0.0.1"}
2026-02-17 11:29:57.959 [[32minfo[39m]: GET /backups 200 3ms {"requestId":"c7edb675-ebdd-4cfa-9334-2d478d49dab4","method":"GET","path":"/backups","url":"/api/cloud/backups?limit=5","statusCode":200,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","query":{"limit":"5"},"rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":354}
2026-02-17 11:29:57.974 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups/id:backup_1/preview:::ffff:127.0.0.1"}
2026-02-17 11:29:57.977 [[32minfo[39m]: Preview backup requested for user 69949785e6b94d3cea2e2436: id:backup_1
2026-02-17 11:29:57.977 [[32minfo[39m]: Generating manual backup for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:57.988 [[32minfo[39m]: Archive created: 521 bytes
2026-02-17 11:29:57.989 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-29-57.zip (521 bytes)
2026-02-17 11:29:57.989 [[32minfo[39m]: Getting backup preview: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-29-57.zip
2026-02-17 11:29:57.989 [[32minfo[39m]: Parsing backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-29-57.zip
2026-02-17 11:29:58.002 [[32minfo[39m]: Backup parsed successfully: 2 recipes
2026-02-17 11:29:58.004 [[32minfo[39m]: GET /backups/id:backup_1/preview 200 30ms {"requestId":"71ead8cd-d346-4cb5-aaef-d3542d6f8c8f","method":"GET","path":"/backups/id:backup_1/preview","url":"/api/cloud/backups/id:backup_1/preview","statusCode":200,"duration":30,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":193}
2026-02-17 11:29:58.013 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:58.021 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.021 [[32minfo[39m]: POST /disconnect 200 8ms {"requestId":"c640d472-70dd-4c1c-ae1f-34cbb122ee53","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":8,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:58.022 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups/id:backup_1/preview:::ffff:127.0.0.1"}
2026-02-17 11:29:58.026 [[33mwarn[39m]: GET /backups/id:backup_1/preview 400 4ms {"requestId":"541d8003-8297-470f-a966-7e35e1f7340b","method":"GET","path":"/backups/id:backup_1/preview","url":"/api/cloud/backups/id:backup_1/preview","statusCode":400,"duration":4,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:29:58.049 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:29:58.118 [[32minfo[39m]: Restore requested for user 69949785e6b94d3cea2e2436: backup=id:backup_1, mode=merge
2026-02-17 11:29:58.118 [[32minfo[39m]: Generating manual backup for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.128 [[32minfo[39m]: Archive created: 494 bytes
2026-02-17 11:29:58.128 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-29-58.zip (494 bytes)
2026-02-17 11:29:58.128 [[32minfo[39m]: Parsing backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-29-58.zip
2026-02-17 11:29:58.139 [[32minfo[39m]: Backup parsed successfully: 1 recipes
2026-02-17 11:29:58.141 [[32minfo[39m]: Starting restore for user 69949785e6b94d3cea2e2436 {"mode":"merge","recipeCount":1}
2026-02-17 11:29:58.142 [[32minfo[39m]: Merge mode: Importing with duplicate checking for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.151 [[32minfo[39m]: Merge mode complete: 1 items imported, 0 skipped
2026-02-17 11:29:58.151 [[32minfo[39m]: Restore successful for user 69949785e6b94d3cea2e2436 {"stats":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:29:58.152 [[32minfo[39m]: Restore successful for user 69949785e6b94d3cea2e2436 {"statistics":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:29:58.154 [[32minfo[39m]: POST /restore 200 104ms {"requestId":"4bd9cbba-0e5b-4509-a347-ca1e0f672c8b","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":200,"duration":104,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":268}
2026-02-17 11:29:58.181 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:29:58.247 [[32minfo[39m]: Restore requested for user 69949785e6b94d3cea2e2436: backup=id:backup_1, mode=replace
2026-02-17 11:29:58.248 [[32minfo[39m]: Generating manual backup for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.257 [[32minfo[39m]: Archive created: 494 bytes
2026-02-17 11:29:58.257 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-29-58.zip (494 bytes)
2026-02-17 11:29:58.257 [[32minfo[39m]: Parsing backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-29-58.zip
2026-02-17 11:29:58.262 [[32minfo[39m]: Backup parsed successfully: 1 recipes
2026-02-17 11:29:58.263 [[32minfo[39m]: Starting restore for user 69949785e6b94d3cea2e2436 {"mode":"replace","recipeCount":1}
2026-02-17 11:29:58.263 [[32minfo[39m]: Replace mode: Deleting existing data for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.269 [[32minfo[39m]: Existing data deleted for user 69949785e6b94d3cea2e2436 {"recipes":1,"collections":0,"mealPlans":0,"shoppingLists":0}
2026-02-17 11:29:58.276 [[32minfo[39m]: Replace mode complete: 1 items imported
2026-02-17 11:29:58.276 [[32minfo[39m]: Restore successful for user 69949785e6b94d3cea2e2436 {"stats":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:29:58.276 [[32minfo[39m]: Restore successful for user 69949785e6b94d3cea2e2436 {"statistics":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:29:58.276 [[32minfo[39m]: POST /restore 200 95ms {"requestId":"61437d16-ddc4-4ef5-9e17-435453c9ea56","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":200,"duration":95,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":268}
2026-02-17 11:29:58.295 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:29:58.297 [[33mwarn[39m]: POST /restore 400 2ms {"requestId":"4604568b-dac4-4797-a5ca-11630bfd1e06","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":96}
2026-02-17 11:29:58.314 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:29:58.315 [[33mwarn[39m]: POST /restore 400 1ms {"requestId":"dc6bd0ff-6903-4f65-b4cf-0d819a7b1ba1","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":76}
2026-02-17 11:29:58.336 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:29:58.399 [[33mwarn[39m]: Invalid password for restore attempt by user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.399 [[33mwarn[39m]: POST /restore 401 63ms {"requestId":"2bc3c3cd-86db-405b-a545-42d520a75c64","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":401,"duration":63,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":46}
2026-02-17 11:29:58.416 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:58.422 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.422 [[32minfo[39m]: POST /disconnect 200 6ms {"requestId":"232bace6-09c1-4f53-8b25-87257916a111","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:58.423 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:29:58.425 [[33mwarn[39m]: POST /restore 400 2ms {"requestId":"5520ce1e-d7cd-4da2-bf07-9b57cb4062c3","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:29:58.436 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.443 [[32minfo[39m]: Schedule updated for user 69949785e6b94d3cea2e2436: enabled=true, frequency=daily
2026-02-17 11:29:58.444 [[32minfo[39m]: PUT /schedule 200 9ms {"requestId":"9354cb93-f716-4623-aa7c-7576972e986d","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":9,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":208}
2026-02-17 11:29:58.450 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.456 [[32minfo[39m]: Schedule updated for user 69949785e6b94d3cea2e2436: enabled=true, frequency=weekly
2026-02-17 11:29:58.456 [[32minfo[39m]: PUT /schedule 200 6ms {"requestId":"52e26aa7-0c49-4307-84a4-409bd27dd442","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":196}
2026-02-17 11:29:58.463 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.471 [[32minfo[39m]: Schedule updated for user 69949785e6b94d3cea2e2436: enabled=false, frequency=undefined
2026-02-17 11:29:58.471 [[32minfo[39m]: PUT /schedule 200 8ms {"requestId":"f15216bc-cca6-4129-b492-683b730ef88b","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":8,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:29:58.480 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.486 [[32minfo[39m]: Schedule updated for user 69949785e6b94d3cea2e2436: enabled=undefined, frequency=invalid
2026-02-17 11:29:58.486 [[32minfo[39m]: PUT /schedule 200 6ms {"requestId":"96c5533b-eae0-413b-bbb4-d651d79c2719","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:29:58.496 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.503 [[32minfo[39m]: Schedule updated for user 69949785e6b94d3cea2e2436: enabled=undefined, frequency=undefined
2026-02-17 11:29:58.503 [[32minfo[39m]: PUT /schedule 200 7ms {"requestId":"29b563ad-19e3-4cf8-bfe5-2cc8321adf0e","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":7,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:29:58.511 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:58.520 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.520 [[32minfo[39m]: POST /disconnect 200 9ms {"requestId":"c4a02f74-e198-4837-9e03-669d7331c04a","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":9,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:58.521 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.523 [[33mwarn[39m]: PUT /schedule 400 2ms {"requestId":"6d6f99ac-e98d-4882-9e24-701ab3b124eb","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:29:58.531 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.533 [[32minfo[39m]: GET /schedule 200 2ms {"requestId":"7276cd4c-5e29-449f-9540-bdd0e3b151e2","method":"GET","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:29:58.537 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:29:58.542 [[32minfo[39m]: dropbox disconnected for user 69949785e6b94d3cea2e2436
2026-02-17 11:29:58.542 [[32minfo[39m]: POST /disconnect 200 5ms {"requestId":"1bcdd5eb-4c31-45cd-9214-ded8b8691c61","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":5,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:29:58.543 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:29:58.546 [[33mwarn[39m]: GET /schedule 400 3ms {"requestId":"c3ca7433-4c28-47c2-b916-81e11b9e4a5b","method":"GET","path":"/schedule","url":"/api/cloud/schedule","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:29:58.554 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/status:::ffff:127.0.0.1"}
2026-02-17 11:29:58.556 [[32minfo[39m]: GET /status 200 2ms {"requestId":"eba0d094-d50b-4cf5-bbdb-db0011a82128","method":"GET","path":"/status","url":"/api/cloud/status","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949785e6b94d3cea2e2436","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":421}
PASS src/__tests__/integration/cloud-backup.test.js
  Cloud Backup API - OAuth Flow
    POST /api/cloud/dropbox/auth
      ‚úì should initiate Dropbox OAuth and return auth URL (7 ms)
      ‚úì should require authentication (4 ms)
    GET /api/cloud/status
      ‚úì should return not connected when no provider configured (9 ms)
      ‚úì should return connected status when provider configured (12 ms)
  Cloud Backup API - Provider Management
    POST /api/cloud/disconnect
      ‚úì should disconnect cloud provider (17 ms)
      ‚úì should fail when no provider connected (25 ms)
  Cloud Backup API - Backup Operations
    POST /api/cloud/backup
      ‚úì should create and upload manual backup successfully (43 ms)
      ‚úì should require cloud provider connection (22 ms)
    GET /api/cloud/backups
      ‚úì should return empty array when no provider connected (21 ms)
      ‚úì should accept limit parameter (9 ms)
    GET /api/cloud/backups/:backupId/preview
      ‚úì should preview backup contents (45 ms)
      ‚úì should require cloud provider connection (22 ms)
    POST /api/cloud/restore
      ‚úì should restore backup in merge mode (135 ms)
      ‚úì should restore backup in replace mode (121 ms)
      ‚úì should validate required fields (19 ms)
      ‚úì should validate mode parameter (19 ms)
      ‚úì should reject invalid password (84 ms)
      ‚úì should require cloud provider connection (25 ms)
  Cloud Backup API - Schedule Management
    PUT /api/cloud/schedule
      ‚úì should update schedule settings (13 ms)
      ‚úì should calculate next backup time when enabled (11 ms)
      ‚úì should clear next backup time when disabled (15 ms)
      ‚úì should validate frequency values (17 ms)
      ‚úì should validate time format (16 ms)
      ‚úì should require cloud provider connection (19 ms)
    GET /api/cloud/schedule
      ‚úì should return current schedule (9 ms)
      ‚úì should require cloud provider connection (14 ms)
  Token Encryption
    ‚úì should encrypt and decrypt tokens correctly
    ‚úì should use different IVs for same token
    ‚úì should throw error for empty strings (3 ms)
  Security - Token Protection
    ‚úì should not expose tokens in JSON response (7 ms)

(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:30:00.488 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:00.596 [[32minfo[39m]: POST /register 201 108ms {"requestId":"3deb2f9c-5714-4287-94fb-338f7275f3ca","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":108,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:00.600 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:00.781 [[32minfo[39m]: POST /2fa/setup 200 181ms {"requestId":"fa945b94-d658-4cc8-979b-bc0ec726f298","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":181,"ip":"::ffff:127.0.0.1","userId":"69949788176ffa04a1821eb5","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3296}
2026-02-17 11:30:00.802 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:00.882 [[32minfo[39m]: POST /register 201 80ms {"requestId":"9d78f0f2-ceac-4c39-8fbf-86e737b0d2ae","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:00.883 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:00.884 [[33mwarn[39m]: POST /2fa/setup 401 1ms {"requestId":"d715cd4b-3b99-47a3-94be-489478a8630d","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":401,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:30:00.893 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:00.973 [[32minfo[39m]: POST /register 201 80ms {"requestId":"4576c610-85c7-4176-91bc-1514eb6670b0","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:00.975 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:01.148 [[32minfo[39m]: POST /2fa/setup 200 172ms {"requestId":"f823415f-3c06-4add-9336-d43e071a8761","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":172,"ip":"::ffff:127.0.0.1","userId":"69949788176ffa04a1821ece","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3260}
2026-02-17 11:30:01.150 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:01.323 [[32minfo[39m]: POST /2fa/setup 200 173ms {"requestId":"f42b8ea0-2d02-4cac-9866-a9524e765112","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":173,"ip":"::ffff:127.0.0.1","userId":"69949788176ffa04a1821ece","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3272}
2026-02-17 11:30:01.332 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:01.411 [[32minfo[39m]: POST /register 201 79ms {"requestId":"937f2f80-ce2c-471b-a451-9132130cea8b","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:01.413 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:01.589 [[32minfo[39m]: POST /2fa/setup 200 176ms {"requestId":"e6c3ecb5-3f74-4eb2-8fd0-92436bd88268","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":176,"ip":"::ffff:127.0.0.1","userId":"69949789176ffa04a1821edf","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3296}
2026-02-17 11:30:01.592 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:30:01.602 [[32minfo[39m]: POST /2fa/verify 200 10ms {"requestId":"99f6faa3-801c-47f2-b6a9-06c155611945","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":200,"duration":10,"ip":"::ffff:127.0.0.1","userId":"69949789176ffa04a1821edf","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":954}
2026-02-17 11:30:01.611 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:01.698 [[32minfo[39m]: POST /register 201 87ms {"requestId":"5cea784f-0315-41d9-b3ca-71c5b96921b7","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":87,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:01.699 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:01.884 [[32minfo[39m]: POST /2fa/setup 200 185ms {"requestId":"56723a04-5a41-4607-b6bb-ce7774df59b0","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":185,"ip":"::ffff:127.0.0.1","userId":"69949789176ffa04a1821ef1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3308}
2026-02-17 11:30:01.886 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:30:01.889 [[33mwarn[39m]: POST /2fa/verify 400 3ms {"requestId":"cc752f73-13c7-484c-866d-acd661c2127b","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949789176ffa04a1821ef1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":47}
2026-02-17 11:30:01.897 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:01.979 [[32minfo[39m]: POST /register 201 82ms {"requestId":"2155c79b-c7f0-4add-bf65-b6e6e69eb9be","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:01.981 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:02.154 [[32minfo[39m]: POST /2fa/setup 200 174ms {"requestId":"8494999e-580e-4531-b1a5-a2fda3304bd2","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":174,"ip":"::ffff:127.0.0.1","userId":"69949789176ffa04a1821f02","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3312}
2026-02-17 11:30:02.156 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:30:02.156 [[33mwarn[39m]: POST /2fa/verify 401 0ms {"requestId":"a2bee16f-aeac-4453-aba4-c5b4da67ba24","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:30:02.164 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:02.241 [[32minfo[39m]: POST /register 201 77ms {"requestId":"5f80aae4-c4cc-4f1b-8c90-56979a463a6a","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:02.242 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:02.419 [[32minfo[39m]: POST /2fa/setup 200 177ms {"requestId":"6efe4e43-c4b4-4e9a-a4ee-3c93429fb646","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":177,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f10","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3300}
2026-02-17 11:30:02.421 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:30:02.422 [[33mwarn[39m]: POST /2fa/verify 400 1ms {"requestId":"8785682e-10bf-4f09-8ed2-d30b443e9c27","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f10","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":29}
2026-02-17 11:30:02.430 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:02.508 [[32minfo[39m]: POST /register 201 78ms {"requestId":"4cbb69b4-39fb-4138-87f6-a378a3a5e91e","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":78,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:02.510 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/status:::ffff:127.0.0.1"}
2026-02-17 11:30:02.512 [[32minfo[39m]: GET /2fa/status 200 2ms {"requestId":"28990f50-e355-4f2a-b190-e94612824a25","method":"GET","path":"/2fa/status","url":"/api/auth/2fa/status","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f1f","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":17}
2026-02-17 11:30:02.520 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:02.599 [[32minfo[39m]: POST /register 201 79ms {"requestId":"c81b0939-69bf-494b-aae1-8a42c056b0a4","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:02.600 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:02.782 [[32minfo[39m]: POST /2fa/setup 200 182ms {"requestId":"1f4a3b62-ac14-46b1-a97f-bb9e28f4fa0d","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":182,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f2d","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3268}
2026-02-17 11:30:02.785 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:30:02.794 [[32minfo[39m]: POST /2fa/verify 200 9ms {"requestId":"c639cdfe-0fec-4efb-be30-ee5ff1b137f9","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":200,"duration":9,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f2d","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":954}
2026-02-17 11:30:02.795 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/status:::ffff:127.0.0.1"}
2026-02-17 11:30:02.797 [[32minfo[39m]: GET /2fa/status 200 2ms {"requestId":"2ecb7021-52c3-4fb7-b476-df82af50060f","method":"GET","path":"/2fa/status","url":"/api/auth/2fa/status","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f2d","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":16}
2026-02-17 11:30:02.806 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:02.888 [[32minfo[39m]: POST /register 201 82ms {"requestId":"030326c1-3c6d-4de0-af32-d62291519d14","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:02.889 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/status:::ffff:127.0.0.1"}
2026-02-17 11:30:02.889 [[33mwarn[39m]: GET /2fa/status 401 0ms {"requestId":"6a6cf09d-aff5-491f-a701-95c4f3280101","method":"GET","path":"/2fa/status","url":"/api/auth/2fa/status","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:30:02.894 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:02.969 [[32minfo[39m]: POST /register 201 75ms {"requestId":"9b25fce2-591f-449b-b7ef-ed827595b16f","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":75,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:02.971 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.144 [[32minfo[39m]: POST /2fa/setup 200 173ms {"requestId":"a537d3e8-3a17-44f0-bb48-3177fe948595","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":173,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f4d","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3252}
2026-02-17 11:30:03.146 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:30:03.155 [[32minfo[39m]: POST /2fa/verify 200 9ms {"requestId":"87d3d468-b73c-4a3b-aec0-7413a667b222","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":200,"duration":9,"ip":"::ffff:127.0.0.1","userId":"6994978a176ffa04a1821f4d","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":954}
2026-02-17 11:30:03.157 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify-login:::ffff:127.0.0.1"}
2026-02-17 11:30:03.157 [[33mwarn[39m]: POST /2fa/verify-login 429 0ms {"requestId":"faf7dc3b-2683-4e77-981e-97cfceceeaba","method":"POST","path":"/2fa/verify-login","url":"/api/auth/2fa/verify-login","statusCode":429,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":111}
2026-02-17 11:30:03.163 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:03.240 [[32minfo[39m]: POST /register 201 77ms {"requestId":"af618d3f-d0aa-4abb-88e7-caaa90612485","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:03.242 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.424 [[32minfo[39m]: POST /2fa/setup 200 182ms {"requestId":"6bcbff78-f90f-42da-ae85-5f66626468e0","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":182,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821f5f","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3296}
2026-02-17 11:30:03.426 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:30:03.428 [[33mwarn[39m]: POST /2fa/verify 429 2ms {"requestId":"46ebaf90-39f3-4c83-9382-cc4133718150","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821f5f","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":111}
2026-02-17 11:30:03.435 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:03.510 [[32minfo[39m]: POST /register 201 75ms {"requestId":"ea11ccbc-1d26-4f1a-b724-7004510c79dc","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":75,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:03.511 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.513 [[33mwarn[39m]: POST /2fa/setup 429 2ms {"requestId":"b61eac9f-6678-41ab-964f-bd6ee48fcea3","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821f6e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:03.521 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:03.600 [[32minfo[39m]: POST /register 201 79ms {"requestId":"f55ed194-e23b-4c5e-8af8-26b5e30bb059","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:03.601 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.603 [[33mwarn[39m]: POST /2fa/setup 429 2ms {"requestId":"70dedc5e-50c8-4a1f-a745-49e77173aad3","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821f7a","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:03.611 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:03.693 [[32minfo[39m]: POST /register 201 82ms {"requestId":"26c0b502-3db0-48e4-ba2a-b45e0bdc0d31","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:03.695 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.696 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"d00742c5-b56e-49a1-9e48-d92544149021","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821f86","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:03.703 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:03.782 [[32minfo[39m]: POST /register 201 79ms {"requestId":"6a88c943-96a6-4c1c-9a1b-3124d83ac5a6","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:03.784 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.785 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"26ee488a-fa9b-4929-a79b-aaaac34d0d4e","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821f92","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:03.793 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:03.875 [[32minfo[39m]: POST /register 201 82ms {"requestId":"d134ab9f-040d-4dbb-a614-13014e2025f8","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:03.881 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.884 [[33mwarn[39m]: POST /2fa/setup 429 3ms {"requestId":"3abf71c2-b624-4f5a-b12a-b42c6105c936","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":3,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821f9e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:03.893 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:03.975 [[32minfo[39m]: POST /register 201 82ms {"requestId":"85f05c6a-41f7-4578-9cdd-8007624e0696","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:03.976 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:03.977 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"d4d4ab4e-ecea-4ca2-8af2-b0af233ee297","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821faa","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:03.984 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:04.064 [[32minfo[39m]: POST /register 201 80ms {"requestId":"d17d410c-130b-4b71-af25-ed6acff4ed4d","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:04.066 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:04.067 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"d248ca67-41d3-4f08-8770-48fde19fd1fd","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978b176ffa04a1821fb6","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:04.076 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:04.152 [[32minfo[39m]: POST /register 201 76ms {"requestId":"2e1572e2-5989-4eab-a884-6975b22bc426","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":76,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:04.153 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:04.154 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"6cb2de95-a483-47e2-9238-544ceb7703d9","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978c176ffa04a1821fc2","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:04.161 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:04.236 [[32minfo[39m]: POST /register 201 75ms {"requestId":"8315699f-5151-4979-b7de-ed3893247dce","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":75,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:04.237 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:04.238 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"15bfe202-2610-4a42-9ea6-813cd0369d17","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978c176ffa04a1821fce","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:04.245 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:04.322 [[32minfo[39m]: POST /register 201 77ms {"requestId":"efe71f31-78e7-46b0-9c78-7e87558d84c9","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:04.323 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:04.324 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"f6f85a6a-c326-4ebf-a3e0-4ef91a1b2ab8","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978c176ffa04a1821fda","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:30:04.330 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:04.405 [[32minfo[39m]: POST /register 201 75ms {"requestId":"db465a48-31c9-4df7-b529-f6aee82b0a4a","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":75,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:30:04.406 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:30:04.407 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"c344b57a-783d-4341-bd7b-be36eca1934a","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"6994978c176ffa04a1821fe6","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
FAIL src/__tests__/integration/two-factor-auth.test.js (5.848 s)
  Two-Factor Authentication Integration Tests
    POST /api/auth/2fa/setup
      ‚úì should generate 2FA QR code and secret for authenticated user (322 ms)
      ‚úï should require authentication (101 ms)
      ‚úì should generate different secrets for multiple calls (438 ms)
    POST /api/auth/2fa/verify
      ‚úï should enable 2FA with valid token and generate backup codes (280 ms)
      ‚úï should reject invalid token (284 ms)
      ‚úï should require authentication (268 ms)
      ‚úì should require token parameter (266 ms)
    GET /api/auth/2fa/status
      ‚úì should return disabled status when 2FA is not enabled (89 ms)
      ‚úì should return enabled status when 2FA is enabled (285 ms)
      ‚úï should require authentication (92 ms)
    POST /api/auth/2fa/verify-login
      ‚úï should complete login with valid 2FA token (268 ms)
      ‚úï should reject invalid 2FA token (270 ms)
      ‚úï should reject invalid credentials (86 ms)
      ‚úï should accept valid backup code (88 ms)
      ‚úï should reject already-used backup code (94 ms)
      ‚úï should require all parameters (89 ms)
    POST /api/auth/2fa/disable
      ‚úï should disable 2FA with valid password (99 ms)
      ‚úï should reject invalid password (93 ms)
      ‚úï should require password parameter (89 ms)
      ‚úï should require authentication (87 ms)
    Login Flow with 2FA
      ‚úï should require 2FA verification during login when enabled (84 ms)
      ‚úï should complete full login flow with 2FA (85 ms)
      ‚úï should allow normal login after disabling 2FA (83 ms)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/setup ‚Ä∫ should require authentication

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Access token required"
    Received value: "No token provided. Please login to access this resource."

      79 |         .expect(401);
      80 |
    > 81 |       expect(res.body).toHaveProperty('error', 'Access token required');
         |                        ^
      82 |     });
      83 |
      84 |     it('should generate different secrets for multiple calls', async () => {

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:81:24)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify ‚Ä∫ should enable 2FA with valid token and generate backup codes

    TypeError: expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has type:  object
    Received has value: {"code": "6b4b1ae155f3d126ecd0d8f4b22ebfb35ee2f917e3c7b3394c8c2682b7a6b5ea", "usedAt": null}

      125 |       // Each backup code should be 8 characters
      126 |       res.body.backupCodes.forEach(code => {
    > 127 |         expect(code).toHaveLength(8);
          |                      ^
      128 |         expect(code).toMatch(/^[A-Z0-9]{8}$/);
      129 |       });
      130 |

      at src/__tests__/integration/two-factor-auth.test.js:127:22
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:126:28)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify ‚Ä∫ should reject invalid token

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Invalid 2FA code"
    Received value: "Secret is required for verification"

      143 |         .expect(400);
      144 |
    > 145 |       expect(res.body).toHaveProperty('error', 'Invalid 2FA code');
          |                        ^
      146 |
      147 |       // Verify 2FA was not enabled
      148 |       const user = await User.findById(testUser._id);

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:145:24)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify ‚Ä∫ should require authentication

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Access token required"
    Received value: "No token provided. Please login to access this resource."

      158 |         .expect(401);
      159 |
    > 160 |       expect(res.body).toHaveProperty('error', 'Access token required');
          |                        ^
      161 |     });
      162 |
      163 |     it('should require token parameter', async () => {

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:160:24)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ GET /api/auth/2fa/status ‚Ä∫ should require authentication

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Access token required"
    Received value: "No token provided. Please login to access this resource."

      211 |         .expect(401);
      212 |
    > 213 |       expect(res.body).toHaveProperty('error', 'Access token required');
          |                        ^
      214 |     });
      215 |   });
      216 |

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:213:24)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify-login ‚Ä∫ should complete login with valid 2FA token

    expected 200 "OK", got 429 "Too Many Requests"

      244 |           token,
      245 |         })
    > 246 |         .expect(200);
          |          ^
      247 |
      248 |       expect(res.body).toHaveProperty('accessToken');
      249 |       expect(res.body).toHaveProperty('refreshToken');

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:246:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify-login ‚Ä∫ should reject invalid 2FA token

    expected 200 "OK", got 429 "Too Many Requests"

      231 |         .set('Authorization', `Bearer ${accessToken}`)
      232 |         .send({ token, secret: twoFactorSecret })
    > 233 |         .expect(200);
          |          ^
      234 |     });
      235 |
      236 |     it('should complete login with valid 2FA token', async () => {

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:233:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify-login ‚Ä∫ should reject invalid credentials

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify-login ‚Ä∫ should accept valid backup code

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify-login ‚Ä∫ should reject already-used backup code

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/verify-login ‚Ä∫ should require all parameters

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/disable ‚Ä∫ should disable 2FA with valid password

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/disable ‚Ä∫ should reject invalid password

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/disable ‚Ä∫ should require password parameter

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ POST /api/auth/2fa/disable ‚Ä∫ should require authentication

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ Login Flow with 2FA ‚Ä∫ should require 2FA verification during login when enabled

    expected 200 "OK", got 429 "Too Many Requests"

      428 |         .post('/api/auth/2fa/setup')
      429 |         .set('Authorization', `Bearer ${accessToken}`)
    > 430 |         .expect(200);
          |          ^
      431 |       
      432 |       twoFactorSecret = setupRes.body.secret;
      433 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:430:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ Login Flow with 2FA ‚Ä∫ should complete full login flow with 2FA

    expected 200 "OK", got 429 "Too Many Requests"

      428 |         .post('/api/auth/2fa/setup')
      429 |         .set('Authorization', `Bearer ${accessToken}`)
    > 430 |         .expect(200);
          |          ^
      431 |       
      432 |       twoFactorSecret = setupRes.body.secret;
      433 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:430:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ‚óè Two-Factor Authentication Integration Tests ‚Ä∫ Login Flow with 2FA ‚Ä∫ should allow normal login after disabling 2FA

    expected 200 "OK", got 429 "Too Many Requests"

      428 |         .post('/api/auth/2fa/setup')
      429 |         .set('Authorization', `Bearer ${accessToken}`)
    > 430 |         .expect(200);
          |          ^
      431 |       
      432 |       twoFactorSecret = setupRes.body.secret;
      433 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:430:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL src/__tests__/integration/v1.1-features.test.js
  V1.1 Features Integration Tests
    Input Validation & Sanitization
      ‚úï should reject recipe with missing required fields (19 ms)
      ‚úï should reject recipe with title exceeding max length (8 ms)
      ‚úï should sanitize HTML in recipe fields (2 ms)
      ‚úï should validate numeric fields (1 ms)
      ‚úï should validate dishType enum (2 ms)
      ‚úï should validate rating range (2 ms)
      ‚úï should validate URL format (2 ms)
      ‚úï should accept valid recipe with all fields (2 ms)
    Pagination
      ‚úï should return paginated results with default limit (26 ms)
      ‚úï should return correct page with custom limit (17 ms)
      ‚úï should return last page correctly (17 ms)
      ‚úï should handle pagination with filters (22 ms)
    Caching
      ‚úï should cache GET requests (8 ms)
      ‚úï should clear cache on recipe creation (3 ms)
      ‚úï should clear cache on recipe update (13 ms)
      ‚úï should clear cache on recipe deletion (10 ms)
    Lock Recipe Feature
      ‚úï should toggle recipe lock status (11 ms)
      ‚úï should prevent deletion of locked recipe (8 ms)
      ‚úï should allow deletion of unlocked recipe (10 ms)
    Error Handling
      ‚úï should return 404 for non-existent recipe (2 ms)
      ‚úï should handle invalid MongoDB ID format (2 ms)
      ‚úì should handle malformed JSON (4 ms)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should reject recipe with missing required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      32 |         });
      33 |
    > 34 |       expect(res.status).toBe(400);
         |                          ^
      35 |       expect(res.body.success).toBe(false);
      36 |       expect(res.body.error).toBe('Validation failed');
      37 |     });

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:34:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should reject recipe with title exceeding max length

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      47 |         });
      48 |
    > 49 |       expect(res.status).toBe(400);
         |                          ^
      50 |       expect(res.body.success).toBe(false);
      51 |     });
      52 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:49:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should sanitize HTML in recipe fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

      61 |         });
      62 |
    > 63 |       expect(res.status).toBe(201);
         |                          ^
      64 |       expect(res.body.data.title).not.toContain('<script>');
      65 |       expect(res.body.data.title).not.toContain('alert');
      66 |       expect(res.body.data.description).not.toContain('<b>');

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:63:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should validate numeric fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      80 |         });
      81 |
    > 82 |       expect(res.status).toBe(400);
         |                          ^
      83 |       expect(res.body.success).toBe(false);
      84 |     });
      85 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:82:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should validate dishType enum

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      94 |         });
      95 |
    > 96 |       expect(res.status).toBe(400);
         |                          ^
      97 |       expect(res.body.success).toBe(false);
      98 |     });
      99 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:96:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should validate rating range

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      108 |         });
      109 |
    > 110 |       expect(res.status).toBe(400);
          |                          ^
      111 |       expect(res.body.success).toBe(false);
      112 |     });
      113 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:110:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should validate URL format

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      122 |         });
      123 |
    > 124 |       expect(res.status).toBe(400);
          |                          ^
      125 |       expect(res.body.success).toBe(false);
      126 |     });
      127 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:124:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Input Validation & Sanitization ‚Ä∫ should accept valid recipe with all fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

      149 |         .send(validRecipe);
      150 |
    > 151 |       expect(res.status).toBe(201);
          |                          ^
      152 |       expect(res.body.success).toBe(true);
      153 |       expect(res.body.data.title).toBe('Valid Recipe');
      154 |     });

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:151:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Pagination ‚Ä∫ should return paginated results with default limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      169 |       const res = await request(app).get('/api/recipes');
      170 |
    > 171 |       expect(res.status).toBe(200);
          |                          ^
      172 |       expect(res.body.success).toBe(true);
      173 |       expect(res.body.data).toHaveLength(25); // Default limit is 50
      174 |       expect(res.body.pagination).toBeDefined();

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:171:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Pagination ‚Ä∫ should return correct page with custom limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      182 |         .query({ page: 2, limit: 10 });
      183 |
    > 184 |       expect(res.status).toBe(200);
          |                          ^
      185 |       expect(res.body.data).toHaveLength(10);
      186 |       expect(res.body.pagination.currentPage).toBe(2);
      187 |       expect(res.body.pagination.limit).toBe(10);

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:184:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Pagination ‚Ä∫ should return last page correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      196 |         .query({ page: 3, limit: 10 });
      197 |
    > 198 |       expect(res.status).toBe(200);
          |                          ^
      199 |       expect(res.body.data).toHaveLength(5); // Only 5 recipes on last page
      200 |       expect(res.body.pagination.hasNextPage).toBe(false);
      201 |       expect(res.body.pagination.hasPrevPage).toBe(true);

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:198:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Pagination ‚Ä∫ should handle pagination with filters

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      215 |         .query({ cuisine: 'Italian', page: 1, limit: 10 });
      216 |
    > 217 |       expect(res.status).toBe(200);
          |                          ^
      218 |       expect(res.body.pagination.totalRecipes).toBe(1);
      219 |     });
      220 |   });

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:217:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Caching ‚Ä∫ should cache GET requests

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      231 |       // First request (cache miss)
      232 |       const res1 = await request(app).get(`/api/recipes/${recipe._id}`);
    > 233 |       expect(res1.status).toBe(200);
          |                           ^
      234 |
      235 |       // Second request (should be cached)
      236 |       const res2 = await request(app).get(`/api/recipes/${recipe._id}`);

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:233:27)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Caching ‚Ä∫ should clear cache on recipe creation

    TypeError: Cannot read properties of undefined (reading 'length')

      254 |       // Get list again (should reflect new recipe)
      255 |       const res = await request(app).get('/api/recipes');
    > 256 |       expect(res.body.data.length).toBe(1);
          |                            ^
      257 |     });
      258 |
      259 |     test('should clear cache on recipe update', async () => {

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:256:28)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Caching ‚Ä∫ should clear cache on recipe update

    TypeError: Cannot read properties of undefined (reading 'title')

      278 |       // Get recipe again
      279 |       const res = await request(app).get(`/api/recipes/${recipe._id}`);
    > 280 |       expect(res.body.data.title).toBe('Updated Title');
          |                            ^
      281 |     });
      282 |
      283 |     test('should clear cache on recipe deletion', async () => {

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:280:28)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Caching ‚Ä∫ should clear cache on recipe deletion

    TypeError: Cannot read properties of undefined (reading 'length')

      296 |       // Get list again
      297 |       const res = await request(app).get('/api/recipes');
    > 298 |       expect(res.body.data.length).toBe(0);
          |                            ^
      299 |     });
      300 |   });
      301 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:298:28)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Lock Recipe Feature ‚Ä∫ should toggle recipe lock status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      310 |       // Lock the recipe
      311 |       const lockRes = await request(app).put(`/api/recipes/${recipe._id}/lock`);
    > 312 |       expect(lockRes.status).toBe(200);
          |                              ^
      313 |       expect(lockRes.body.data.isLocked).toBe(true);
      314 |
      315 |       // Unlock the recipe

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:312:30)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Lock Recipe Feature ‚Ä∫ should prevent deletion of locked recipe

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

      329 |       const res = await request(app).delete(`/api/recipes/${recipe._id}`);
      330 |       
    > 331 |       expect(res.status).toBe(403);
          |                          ^
      332 |       expect(res.body.success).toBe(false);
      333 |       expect(res.body.error).toContain('locked');
      334 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:331:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Lock Recipe Feature ‚Ä∫ should allow deletion of unlocked recipe

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      348 |       const res = await request(app).delete(`/api/recipes/${recipe._id}`);
      349 |       
    > 350 |       expect(res.status).toBe(200);
          |                          ^
      351 |       expect(res.body.success).toBe(true);
      352 |
      353 |       // Verify recipe is deleted

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:350:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Error Handling ‚Ä∫ should return 404 for non-existent recipe

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

      362 |       const res = await request(app).get(`/api/recipes/${fakeId}`);
      363 |
    > 364 |       expect(res.status).toBe(404);
          |                          ^
      365 |       expect(res.body.success).toBe(false);
      366 |     });
      367 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:364:26)

  ‚óè V1.1 Features Integration Tests ‚Ä∫ Error Handling ‚Ä∫ should handle invalid MongoDB ID format

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 401

      369 |       const res = await request(app).get('/api/recipes/invalid-id');
      370 |
    > 371 |       expect(res.status).toBe(500);
          |                          ^
      372 |       expect(res.body.success).toBe(false);
      373 |     });
      374 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:371:26)

(node:64158) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:30:07.309 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:07.405 [[32minfo[39m]: POST /register 201 96ms {"requestId":"197298f2-ac00-4a6f-897f-79766bb4afe7","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":96,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:07.407 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:07.598 [[32minfo[39m]: PATCH /password 200 191ms {"requestId":"c94a0f09-b6c5-4283-b1b1-8b150e126ca9","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":191,"ip":"::ffff:127.0.0.1","userId":"6994978fd59c467f800ab06e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:30:07.600 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:30:07.671 [[32minfo[39m]: POST /login 200 71ms {"requestId":"09172359-4aa3-463e-9a58-61da448b4e8f","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":71,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:07.682 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:07.763 [[32minfo[39m]: POST /register 201 81ms {"requestId":"9daf5bfa-efd9-4253-9fec-20825de802e3","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":81,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:07.765 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:07.957 [[32minfo[39m]: PATCH /password 200 192ms {"requestId":"04668296-c664-4279-95f7-616c055802bf","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":192,"ip":"::ffff:127.0.0.1","userId":"6994978fd59c467f800ab081","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:30:07.959 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:30:08.021 [[33mwarn[39m]: POST /login 401 62ms {"requestId":"d8ddff8f-77c5-4899-8c4c-dd7bb58bdf6f","method":"POST","path":"/login","url":"/api/auth/login","statusCode":401,"duration":62,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":54}
2026-02-17 11:30:08.029 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:08.109 [[32minfo[39m]: POST /register 201 80ms {"requestId":"41d03a8f-f2bc-48b3-9d81-032b6b0963df","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:08.111 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:08.173 [[33mwarn[39m]: PATCH /password 400 62ms {"requestId":"b7c9f76a-e8ba-4f5c-afac-92895a58df5d","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":62,"ip":"::ffff:127.0.0.1","userId":"69949790d59c467f800ab092","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:30:08.182 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:08.261 [[32minfo[39m]: POST /register 201 79ms {"requestId":"ea676754-7bb4-40b2-8f13-c33276f040e5","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:08.263 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:08.264 [[33mwarn[39m]: PATCH /password 400 1ms {"requestId":"98f799db-6a6a-45d9-aed7-fa849101db1f","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949790d59c467f800ab0a0","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":71}
2026-02-17 11:30:08.273 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:08.350 [[32minfo[39m]: POST /register 201 77ms {"requestId":"5d66c203-2e36-4ec9-9e86-cffe15d641ed","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:08.352 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:08.476 [[33mwarn[39m]: PATCH /password 400 124ms {"requestId":"d0b1b291-ef7c-4d73-9ab6-8808b037477c","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":124,"ip":"::ffff:127.0.0.1","userId":"69949790d59c467f800ab0ac","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":81}
2026-02-17 11:30:08.482 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:08.561 [[32minfo[39m]: POST /register 201 79ms {"requestId":"ec323d97-af13-4958-9dc9-32cac652b1a4","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:08.562 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:08.562 [[33mwarn[39m]: PATCH /password 401 0ms {"requestId":"f41f1c3f-0af4-4770-affa-ae4c25effbf2","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:30:08.567 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:08.643 [[32minfo[39m]: POST /register 201 76ms {"requestId":"85cd1474-8414-4782-844a-e7186cb74984","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":76,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:08.645 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:08.646 [[33mwarn[39m]: PATCH /password 400 1ms {"requestId":"5a7371c4-2f01-44d3-9fdc-af4f6929d273","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949790d59c467f800ab0c5","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":68}
2026-02-17 11:30:08.654 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:08.732 [[32minfo[39m]: POST /register 201 78ms {"requestId":"d2aae76e-bbea-4741-b768-441ad61623dc","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":78,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:08.733 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:08.918 [[32minfo[39m]: PATCH /password 200 185ms {"requestId":"123371fa-d832-4e69-b800-8edb7ae226b5","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":185,"ip":"::ffff:127.0.0.1","userId":"69949790d59c467f800ab0d1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:30:08.919 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/me:::ffff:127.0.0.1"}
2026-02-17 11:30:08.920 [[32minfo[39m]: GET /me 200 1ms {"requestId":"ed162f59-3ca8-441f-a88c-37279952456d","method":"GET","path":"/me","url":"/api/auth/me","statusCode":200,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949790d59c467f800ab0d1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":320}
2026-02-17 11:30:08.930 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:09.010 [[32minfo[39m]: POST /register 201 80ms {"requestId":"07f44d5e-46b2-4ba0-a2be-b9d0d03775bc","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:09.019 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:09.092 [[32minfo[39m]: DELETE /account 200 72ms {"requestId":"df0ce1b1-2523-4888-bb3d-411636cf3bf8","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":72,"ip":"::ffff:127.0.0.1","userId":"69949790d59c467f800ab0e1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:30:09.096 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:09.290 [[32minfo[39m]: POST /register 201 194ms {"requestId":"0661836c-7f23-4c50-907a-9dfa3b685c9d","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":194,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:09.295 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:09.473 [[32minfo[39m]: DELETE /account 200 178ms {"requestId":"8ad7c801-3bd6-4665-bdc8-d2659767e913","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":178,"ip":"::ffff:127.0.0.1","userId":"69949791d59c467f800ab0f6","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:30:09.475 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:30:09.482 [[33mwarn[39m]: POST /login 401 7ms {"requestId":"6ae5e396-ca04-4314-8df8-551b2fe276bb","method":"POST","path":"/login","url":"/api/auth/login","statusCode":401,"duration":7,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":54}
2026-02-17 11:30:09.491 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:09.571 [[32minfo[39m]: POST /register 201 80ms {"requestId":"a60ef121-f469-490d-b9ec-3d779a40dd8d","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:09.582 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:09.658 [[32minfo[39m]: DELETE /account 200 76ms {"requestId":"84e14f84-c204-4428-8075-357ed1beb447","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":76,"ip":"::ffff:127.0.0.1","userId":"69949791d59c467f800ab10b","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:30:09.662 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:09.741 [[32minfo[39m]: POST /register 201 79ms {"requestId":"8005f263-a5ac-42e6-9273-fbf43475c994","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:09.759 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:09.834 [[32minfo[39m]: DELETE /account 200 76ms {"requestId":"ae0e2475-3bbf-4e25-9592-cba46c272c62","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":76,"ip":"::ffff:127.0.0.1","userId":"69949791d59c467f800ab127","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:30:09.838 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:09.920 [[32minfo[39m]: POST /register 201 82ms {"requestId":"e19f6fdc-8e20-4f81-a211-d01f737f9973","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:09.933 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:10.010 [[32minfo[39m]: POST /register 201 77ms {"requestId":"1adeb137-c815-4ab8-a9f2-fc1f4495e8eb","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:10.018 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:10.091 [[32minfo[39m]: DELETE /account 200 73ms {"requestId":"c18883b3-e600-446a-901e-921b9b18b4c6","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":73,"ip":"::ffff:127.0.0.1","userId":"69949791d59c467f800ab14f","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:30:10.095 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:10.172 [[32minfo[39m]: POST /register 201 77ms {"requestId":"2da5d1ed-51f0-4fa1-977b-5e8a8e259558","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:10.173 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:10.235 [[33mwarn[39m]: DELETE /account 400 62ms {"requestId":"570f6620-63d9-4496-9297-6fde3ac1955b","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":400,"duration":62,"ip":"::ffff:127.0.0.1","userId":"69949792d59c467f800ab169","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":50}
2026-02-17 11:30:10.244 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:10.323 [[32minfo[39m]: POST /register 201 79ms {"requestId":"84528f8b-fb0e-41b0-874a-1c4ea2236e30","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:10.324 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:10.324 [[33mwarn[39m]: DELETE /account 401 0ms {"requestId":"40f3328a-c2a3-4b77-97a3-13c74555e9cd","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:30:10.332 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:10.407 [[32minfo[39m]: POST /register 201 75ms {"requestId":"52bedcc8-5e68-4184-8f3d-af78f0fb4809","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":75,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:10.408 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:10.410 [[33mwarn[39m]: DELETE /account 400 2ms {"requestId":"d6990e7e-3dfb-4424-9dbe-d92099ec9bbc","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949792d59c467f800ab184","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":72}
2026-02-17 11:30:10.417 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:30:10.497 [[32minfo[39m]: POST /register 201 80ms {"requestId":"2d6349be-34f7-4f0c-a585-6b79931e9efb","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:30:10.509 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:30:10.693 [[32minfo[39m]: PATCH /password 200 184ms {"requestId":"e28fc2b0-85fe-4e60-ae35-df8b729702d4","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":184,"ip":"::ffff:127.0.0.1","userId":"69949792d59c467f800ab190","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:30:10.694 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/me:::ffff:127.0.0.1"}
2026-02-17 11:30:10.696 [[32minfo[39m]: GET /me 200 2ms {"requestId":"9007af06-c3d9-4fd8-a06c-2707f7c6e7ea","method":"GET","path":"/me","url":"/api/auth/me","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949792d59c467f800ab190","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":320}
2026-02-17 11:30:10.697 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:30:10.766 [[32minfo[39m]: DELETE /account 200 69ms {"requestId":"74753a3f-784d-4a32-8e86-f3c345d2d4b3","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":69,"ip":"::ffff:127.0.0.1","userId":"69949792d59c467f800ab190","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
FAIL src/__tests__/integration/account-management.test.js (5.38 s)
  Account Management - Update Password
    ‚úì should update password successfully (388 ms)
    ‚úì should verify old password no longer works after update (350 ms)
    ‚úì should reject incorrect current password (152 ms)
    ‚úì should reject weak new password (91 ms)
    ‚úì should reject new password same as current (211 ms)
    ‚úì should reject request without authentication (87 ms)
    ‚úì should reject missing fields (83 ms)
    ‚úì should keep session active after password change (274 ms)
  Account Management - Delete Account
    ‚úì should delete account successfully (172 ms)
    ‚úì should prevent login after account deletion (390 ms)
    ‚úì should delete all user recipes on account deletion (175 ms)
    ‚úì should delete all user collections on account deletion (176 ms)
    ‚úï should delete all user meal plans on account deletion (88 ms)
    ‚úì should delete all user shopping lists on account deletion (167 ms)
    ‚úì should reject incorrect password for account deletion (144 ms)
    ‚úì should reject request without authentication (88 ms)
    ‚úì should reject missing password (85 ms)
  Account Management - Complete Flow
    ‚úì should complete full account lifecycle (358 ms)

  ‚óè Account Management - Delete Account ‚Ä∫ should delete all user meal plans on account deletion

    ValidationError: MealPlan validation failed: endDate: End date must be after start date

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

PASS src/models/__tests__/Recipe.test.js
  Recipe Model (REQ-006)
    Schema Validation
      ‚úì should create a recipe with valid required fields (80 ms)
      ‚úì should fail when title is missing (4 ms)
      ‚úì should fail when ingredients are missing (4 ms)
      ‚úì should fail when instructions are missing (18 ms)
      ‚úì should require name in ingredient (2 ms)
    DishType Enum Validation
      ‚úì should accept valid dishType: Appetizer (2 ms)
      ‚úì should accept valid dishType: Main Course (2 ms)
      ‚úì should accept valid dishType: Side Dish (2 ms)
      ‚úì should accept valid dishType: Dessert (30 ms)
      ‚úì should accept valid dishType: Beverage (3 ms)
      ‚úì should accept valid dishType: Snack (1 ms)
      ‚úì should accept valid dishType: Breakfast (2 ms)
      ‚úì should accept valid dishType: Lunch (1 ms)
      ‚úì should accept valid dishType: Dinner (2 ms)
      ‚úì should accept valid dishType: Other (27 ms)
      ‚úì should reject invalid dishType (1 ms)
      ‚úì should default to "Other" when dishType not provided (2 ms)
    Numeric Field Validation
      ‚úì should accept valid prepTime (1 ms)
      ‚úì should reject negative prepTime (3 ms)
      ‚úì should reject negative cookTime (1 ms)
      ‚úì should accept valid servings (2 ms)
      ‚úì should reject servings below minimum (1 ms)
      ‚úì should accept valid rating within range (1 ms)
      ‚úì should reject rating below minimum (1 ms)
      ‚úì should reject rating above maximum (1 ms)
    Text Field Trimming
      ‚úì should trim title (3 ms)
      ‚úì should trim description (1 ms)
      ‚úì should trim cuisine (1 ms)
      ‚úì should trim sourceUrl (1 ms)
    Array Fields
      ‚úì should handle multiple ingredients (3 ms)
      ‚úì should handle multiple instructions (1 ms)
      ‚úì should handle tags array (2 ms)
    Timestamps
      ‚úì should automatically add createdAt timestamp (1 ms)
      ‚úì should automatically add updatedAt timestamp (2 ms)
      ‚úì should update updatedAt on modification (14 ms)
    Indexes
      ‚úì should have text index on title and description (2 ms)
      ‚úì should support text search on title (7 ms)
    Optional Fields
      ‚úì should allow recipe without description (2 ms)
      ‚úì should allow recipe without times (1 ms)
      ‚úì should allow recipe without rating (2 ms)
      ‚úì should allow recipe without sourceUrl (1 ms)
    Ingredient Schema
      ‚úì should allow ingredient with only name (2 ms)
      ‚úì should store ingredient with all fields (1 ms)
      ‚úì should not add _id to ingredients (1 ms)

PASS src/services/__tests__/scraper.test.js
  Scraper Service
    HTML Entity Decoding (REQ-005)
      ‚úì should decode common HTML entities (5 ms)
      ‚úì should decode numeric HTML entities (1 ms)
      ‚úì should decode hex HTML entities (1 ms)
    JSON-LD Recipe Extraction
      ‚úì should extract recipe from JSON-LD schema (1 ms)
      ‚úì should handle @graph wrapped JSON-LD
    Servings Extraction
      ‚úì should extract servings from recipeYield number
      ‚úì should extract servings from recipeYield string (1 ms)
      ‚úì should handle various servings formats (1 ms)
    DishType Mapping
      ‚úì should map recipeCategory to valid dishType enum (3 ms)
    Time Parsing
      ‚úì should parse ISO 8601 duration format
    Ingredient Cleaning
      ‚úì should remove duplicate ingredients (1 ms)
      ‚úì should filter out very short or very long ingredients (1 ms)
    Instruction Cleaning
      ‚úì should remove HTML tags from instructions
      ‚úì should remove URLs from instructions
      ‚úì should remove duplicate instructions (1 ms)
      ‚úì should filter out very short instructions
    Error Handling
      ‚úì should throw error on network failure (1 ms)
      ‚úì should throw error when title is missing
      ‚úì should handle timeout (102 ms)
    Source URL
      ‚úì should include source URL in result (1 ms)

Test Suites: 7 failed, 3 passed, 10 total
Tests:       115 failed, 122 passed, 237 total
Snapshots:   0 total
Time:        209.68 s, estimated 427 s
Ran all test suites.
‚úì MongoDB Memory Server stopped
‚úì All connections closed
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
