
> recipe-book-backend@2.2.2 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --forceExit

âœ“ MongoDB Memory Server started
  URI: mongodb://127.0.0.1:27017/?replicaSet=testset
(node:69131) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:40:42.467 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:42.584 [[32minfo[39m]: POST /login 200 117ms {"requestId":"895150d4-ff96-4a92-809f-879468b17c8e","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":117,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:42.591 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
2026-02-17 11:40:42.592 [[33mwarn[39m]: POST /register 400 1ms {"requestId":"a88c366f-ed1a-4082-8c53-c5d77a766784","method":"POST","path":"/register","url":"/api/auth/register","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":79}
2026-02-17 11:40:42.721 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:42.802 [[32minfo[39m]: POST /login 200 81ms {"requestId":"7937f150-48b6-4eb7-a0fe-c8fb448ff287","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":81,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:42.804 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/me:::ffff:127.0.0.1"}
2026-02-17 11:40:42.804 [[33mwarn[39m]: GET /me 401 0ms {"requestId":"0035a608-a9d6-499e-b82f-7f4385ce90d7","method":"GET","path":"/me","url":"/api/auth/me","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":73}
2026-02-17 11:40:42.888 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:42.972 [[32minfo[39m]: POST /login 200 84ms {"requestId":"32326464-9d34-417c-a707-1ad7e645f6f2","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":84,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:42.975 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/send-verification:::ffff:127.0.0.1"}
2026-02-17 11:40:42.975 [[33mwarn[39m]: POST /send-verification 401 0ms {"requestId":"13deff4f-3708-40c8-9266-40774aa8976a","method":"POST","path":"/send-verification","url":"/api/auth/send-verification","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":73}
2026-02-17 11:40:43.064 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:43.142 [[32minfo[39m]: POST /login 200 78ms {"requestId":"3c18c168-19a5-4c8d-a4f8-900fcc9bcc8b","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":78,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:43.143 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/send-verification:::ffff:127.0.0.1"}
2026-02-17 11:40:43.144 [[33mwarn[39m]: POST /send-verification 401 1ms {"requestId":"6ffef6a0-67cc-46d7-8280-22e3f81f3add","method":"POST","path":"/send-verification","url":"/api/auth/send-verification","statusCode":401,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:40:43.225 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:43.302 [[32minfo[39m]: POST /login 200 77ms {"requestId":"8c262c2e-fa9d-4190-b063-1737a8ff53fb","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:43.309 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/send-verification:::ffff:127.0.0.1"}
2026-02-17 11:40:43.309 [[33mwarn[39m]: POST /send-verification 401 0ms {"requestId":"4e688df6-8faf-431d-831b-95af5954021a","method":"POST","path":"/send-verification","url":"/api/auth/send-verification","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":73}
2026-02-17 11:40:43.391 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:43.465 [[32minfo[39m]: POST /login 200 74ms {"requestId":"45f1b34c-1c23-41d0-a5b5-6b81719b9e7f","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":74,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:43.467 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/send-verification:::ffff:127.0.0.1"}
2026-02-17 11:40:43.467 [[33mwarn[39m]: POST /send-verification 401 0ms {"requestId":"7ec295f7-3c14-42a7-9284-a741d1002cb6","method":"POST","path":"/send-verification","url":"/api/auth/send-verification","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":73}
2026-02-17 11:40:43.545 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:43.621 [[32minfo[39m]: POST /login 200 76ms {"requestId":"9f6381bc-7cae-41e3-8c88-92241b3aa863","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":76,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:43.627 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/f0c9335a9917479cd1116e7f943ab7bfac591a315ccd7e866932d3ba8e4b397f:::ffff:127.0.0.1"}
  console.log
    Email verified for user: test@example.com

      at verifyEmail (src/controllers/authController.js:797:13)

2026-02-17 11:40:43.650 [[32minfo[39m]: GET /verify-email/f0c9335a9917479cd1116e7f943ab7bfac591a315ccd7e866932d3ba8e4b397f 200 23ms {"requestId":"229c81dd-b928-45b3-935b-912b45bede25","method":"GET","path":"/verify-email/f0c9335a9917479cd1116e7f943ab7bfac591a315ccd7e866932d3ba8e4b397f","url":"/api/auth/verify-email/f0c9335a9917479cd1116e7f943ab7bfac591a315ccd7e866932d3ba8e4b397f","statusCode":200,"duration":23,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:40:43.734 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:43.816 [[32minfo[39m]: POST /login 200 82ms {"requestId":"3de4cc19-e8d1-4efd-b65b-e0dc27fb4c12","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:43.826 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/invalid-token-123:::ffff:127.0.0.1"}
2026-02-17 11:40:43.828 [[33mwarn[39m]: GET /verify-email/invalid-token-123 400 2ms {"requestId":"bfd009d0-532e-468a-aa09-d5b47bfdb9d9","method":"GET","path":"/verify-email/invalid-token-123","url":"/api/auth/verify-email/invalid-token-123","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":66}
2026-02-17 11:40:43.922 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:43.999 [[32minfo[39m]: POST /login 200 77ms {"requestId":"1049f735-4eb3-4cdf-9a9a-b666704a06c8","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:44.012 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/d59cd7c164e9d43ae8ab25a4ff1e6c312b637bc9e6fcf330f2ed5ba9fc7e2058:::ffff:127.0.0.1"}
2026-02-17 11:40:44.013 [[33mwarn[39m]: GET /verify-email/d59cd7c164e9d43ae8ab25a4ff1e6c312b637bc9e6fcf330f2ed5ba9fc7e2058 400 1ms {"requestId":"05761f76-50de-41bd-9b78-2aff66421669","method":"GET","path":"/verify-email/d59cd7c164e9d43ae8ab25a4ff1e6c312b637bc9e6fcf330f2ed5ba9fc7e2058","url":"/api/auth/verify-email/d59cd7c164e9d43ae8ab25a4ff1e6c312b637bc9e6fcf330f2ed5ba9fc7e2058","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":66}
2026-02-17 11:40:44.096 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:44.175 [[32minfo[39m]: POST /login 200 79ms {"requestId":"3ac1131c-1ff4-47ec-9c7d-48f37cf0e88b","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:44.180 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20:::ffff:127.0.0.1"}
  console.log
    Email verified for user: test@example.com

      at verifyEmail (src/controllers/authController.js:797:13)

2026-02-17 11:40:44.189 [[32minfo[39m]: GET /verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20 200 9ms {"requestId":"77a94e96-34d3-448b-9d83-d2939a4e2a0f","method":"GET","path":"/verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20","url":"/api/auth/verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20","statusCode":200,"duration":9,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:40:44.190 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20:::ffff:127.0.0.1"}
2026-02-17 11:40:44.192 [[33mwarn[39m]: GET /verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20 400 2ms {"requestId":"329a77c9-6378-4bc7-8a81-c3ff1000de67","method":"GET","path":"/verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20","url":"/api/auth/verify-email/9eea9bef4f669451b5e3b152e26b18fc6386699ec40fea32907068f5c0297b20","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":66}
2026-02-17 11:40:44.272 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:44.349 [[32minfo[39m]: POST /login 200 77ms {"requestId":"62aa0df2-a0d0-4705-a162-773c9f2f8294","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:44.357 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb:::ffff:127.0.0.1"}
  console.log
    Email verified for user: test@example.com

      at verifyEmail (src/controllers/authController.js:797:13)

2026-02-17 11:40:44.363 [[32minfo[39m]: GET /verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb 200 6ms {"requestId":"4f1977c6-00f3-42f1-a23a-df57c1722b98","method":"GET","path":"/verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb","url":"/api/auth/verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:40:44.364 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb:::ffff:127.0.0.1"}
2026-02-17 11:40:44.366 [[33mwarn[39m]: GET /verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb 400 2ms {"requestId":"e98e6814-3ec2-4104-8b2a-776a622af30b","method":"GET","path":"/verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb","url":"/api/auth/verify-email/2b9695f76103d2ced0b205a5d05650ee0af34d38b6a4806233668bbf028501fb","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":66}
2026-02-17 11:40:44.447 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:44.522 [[32minfo[39m]: POST /login 200 75ms {"requestId":"e10e854c-eda6-4d36-adc8-ff24dca9b86c","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":75,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:44.610 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:44.691 [[32minfo[39m]: POST /login 200 81ms {"requestId":"7cce5f55-0b73-493d-9408-35066acaa4a6","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":81,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:44.784 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:44.862 [[32minfo[39m]: POST /login 200 78ms {"requestId":"4dc6e89c-571c-4a25-a920-26690e869eba","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":78,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:44.950 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:45.026 [[32minfo[39m]: POST /login 200 76ms {"requestId":"51dafe30-548b-4034-b9bf-770d684d8de6","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":76,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:45.193 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:45.267 [[32minfo[39m]: POST /login 200 75ms {"requestId":"63d4d1f7-aa5f-48f0-90fa-1e2869acb1eb","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":75,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:45.355 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:45.432 [[32minfo[39m]: POST /login 200 77ms {"requestId":"df4416f2-2ad0-4308-a258-e349b0f613eb","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:45.437 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/d50ed4cd33465af8d93d5241d35b1d9ec08ae950b394023832204e50ff6c956b:::ffff:127.0.0.1"}
  console.log
    Email verified for user: test@example.com

      at verifyEmail (src/controllers/authController.js:797:13)

2026-02-17 11:40:45.443 [[32minfo[39m]: GET /verify-email/d50ed4cd33465af8d93d5241d35b1d9ec08ae950b394023832204e50ff6c956b 200 6ms {"requestId":"cacd3fd0-6db9-458a-a6fd-d05b6eedeab8","method":"GET","path":"/verify-email/d50ed4cd33465af8d93d5241d35b1d9ec08ae950b394023832204e50ff6c956b","url":"/api/auth/verify-email/d50ed4cd33465af8d93d5241d35b1d9ec08ae950b394023832204e50ff6c956b","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:40:45.444 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/verify-email/invalid-token-123456789012345678901234567890:::ffff:127.0.0.1"}
2026-02-17 11:40:45.445 [[33mwarn[39m]: GET /verify-email/invalid-token-123456789012345678901234567890 400 1ms {"requestId":"73206ef7-c0dd-432d-b564-79192e779cde","method":"GET","path":"/verify-email/invalid-token-123456789012345678901234567890","url":"/api/auth/verify-email/invalid-token-123456789012345678901234567890","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":66}
2026-02-17 11:40:45.527 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:45.609 [[32minfo[39m]: POST /login 200 82ms {"requestId":"f0bae2ea-1725-4331-ab13-e5e6d6a7f51c","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":82,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:45.610 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
2026-02-17 11:40:45.611 [[33mwarn[39m]: POST /register 400 1ms {"requestId":"bd78d184-2316-4c7e-9c40-5df19e1640c4","method":"POST","path":"/register","url":"/api/auth/register","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":79}
FAIL src/__tests__/integration/email-verification.test.js (7.492 s)
  Email Verification Integration Tests
    POST /api/auth/register
      âœ• should create user with emailVerified=false by default (277 ms)
    GET /api/auth/me
      âœ• should include emailVerified status (208 ms)
    POST /api/auth/send-verification
      âœ• should send verification email for authenticated user (170 ms)
      âœ“ should fail without authentication (168 ms)
      âœ• should fail if email already verified (166 ms)
      âœ• should enforce rate limiting (3 requests per hour) (157 ms)
    GET /api/auth/verify-email/:token
      âœ“ should verify email with valid token (185 ms)
      âœ“ should fail with invalid token (178 ms)
      âœ“ should fail with expired token (184 ms)
      âœ“ should fail if email already verified (177 ms)
      âœ“ should invalidate token after successful verification (175 ms)
    Token Security
      âœ“ should hash verification tokens in database (162 ms)
      âœ“ should generate unique tokens for each request (170 ms)
    Token Expiration
      âœ• should set expiration to 24 hours from creation (169 ms)
    User Model - cleanupExpiredTokens
      âœ• should remove expired verification tokens (243 ms)
      âœ“ should not remove valid tokens (162 ms)
    Security - Timing Attacks
      âœ“ should take similar time for valid and invalid tokens (171 ms)
    Integration with Registration Flow
      âœ• should complete full registration and verification flow (165 ms)

  â— Email Verification Integration Tests â€º POST /api/auth/register â€º should create user with emailVerified=false by default

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

      51 |         });
      52 |
    > 53 |       expect(res.status).toBe(201);
         |                          ^
      54 |       expect(res.body).toHaveProperty('accessToken');
      55 |       expect(res.body).toHaveProperty('user');
      56 |       expect(res.body.user.emailVerified).toBe(false);

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:53:26)

  â— Email Verification Integration Tests â€º GET /api/auth/me â€º should include emailVerified status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      70 |         .set('Authorization', `Bearer ${accessToken}`);
      71 |
    > 72 |       expect(res.status).toBe(200);
         |                          ^
      73 |       expect(res.body).toHaveProperty('emailVerified');
      74 |       expect(res.body.emailVerified).toBe(false);
      75 |     });

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:72:26)

  â— Email Verification Integration Tests â€º POST /api/auth/send-verification â€º should send verification email for authenticated user

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      82 |         .set('Authorization', `Bearer ${accessToken}`);
      83 |
    > 84 |       expect(res.status).toBe(200);
         |                          ^
      85 |       expect(res.body.message).toContain('verification email sent');
      86 |       
      87 |       // Verify token was created in database

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:84:26)

  â— Email Verification Integration Tests â€º POST /api/auth/send-verification â€º should fail if email already verified

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      107 |         .set('Authorization', `Bearer ${accessToken}`);
      108 |
    > 109 |       expect(res.status).toBe(400);
          |                          ^
      110 |       expect(res.body.error).toContain('already verified');
      111 |     });
      112 |

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:109:26)

  â— Email Verification Integration Tests â€º POST /api/auth/send-verification â€º should enforce rate limiting (3 requests per hour)

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      117 |           .post('/api/auth/send-verification')
      118 |           .set('Authorization', `Bearer ${accessToken}`);
    > 119 |         expect(res.status).toBe(200);
          |                            ^
      120 |       }
      121 |
      122 |       // 4th request should be rate limited

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:119:28)

  â— Email Verification Integration Tests â€º Token Expiration â€º should set expiration to 24 hours from creation

    TypeError: Cannot read properties of undefined (reading 'getTime')

      231 |
      232 |       const user = await User.findById(testUser._id);
    > 233 |       const expiresAt = user.emailVerificationExpires.getTime();
          |                                                       ^
      234 |       
      235 |       // Should expire approximately 24 hours from now
      236 |       const expectedExpiry = beforeCreate + 24 * 60 * 60 * 1000;

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:233:55)

  â— Email Verification Integration Tests â€º User Model - cleanupExpiredTokens â€º should remove expired verification tokens

    expect(received).toBeUndefined()

    Received: "0f704b8e61c70ac1ccb5be2bef318c72221fb0141b2dbe57b1f9fe65fc9e5c4c"

      264 |       // Verify token was removed
      265 |       user = await User.findById(expiredUser._id).select('+emailVerificationToken');
    > 266 |       expect(user.emailVerificationToken).toBeUndefined();
          |                                           ^
      267 |       expect(user.emailVerificationExpires).toBeUndefined();
      268 |     });
      269 |

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:266:43)

  â— Email Verification Integration Tests â€º Integration with Registration Flow â€º should complete full registration and verification flow

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

      312 |         });
      313 |
    > 314 |       expect(registerRes.status).toBe(201);
          |                                  ^
      315 |       expect(registerRes.body.user.emailVerified).toBe(false);
      316 |       
      317 |       const newAccessToken = registerRes.body.accessToken;

      at Object.<anonymous> (src/__tests__/integration/email-verification.test.js:314:34)

(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:40:48.064 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:48.203 [[32minfo[39m]: POST /register 201 139ms {"requestId":"b305cd16-130a-4700-97ee-2a0994121a91","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":139,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:48.209 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:48.516 [[32minfo[39m]: POST /2fa/setup 200 308ms {"requestId":"7978287f-d2bf-4537-af81-ca718db26883","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":308,"ip":"::ffff:127.0.0.1","userId":"69949a10c59156f74c1409b4","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3340}
2026-02-17 11:40:48.528 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:48.622 [[32minfo[39m]: POST /register 201 94ms {"requestId":"e1e399e0-5e4a-4686-90b5-883a87c09078","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":94,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:48.625 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:48.625 [[33mwarn[39m]: POST /2fa/setup 401 0ms {"requestId":"c12bb1e7-d620-4a54-9098-65bf151c4895","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:40:48.636 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:48.727 [[32minfo[39m]: POST /register 201 91ms {"requestId":"ae6b89c1-d1e1-4ff5-aa95-68d65188f16e","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":91,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:48.729 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:48.986 [[32minfo[39m]: POST /2fa/setup 200 258ms {"requestId":"d659365d-a34a-4f85-8f92-0d005e30a0fb","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":258,"ip":"::ffff:127.0.0.1","userId":"69949a10c59156f74c1409cf","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3268}
2026-02-17 11:40:48.987 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:49.247 [[32minfo[39m]: POST /2fa/setup 200 260ms {"requestId":"49454e09-0d0b-48c5-8e48-7ed2f79c4426","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":260,"ip":"::ffff:127.0.0.1","userId":"69949a10c59156f74c1409cf","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3224}
2026-02-17 11:40:49.259 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:49.358 [[32minfo[39m]: POST /register 201 99ms {"requestId":"0e7ef9ff-f5da-4f68-8fee-a9efdbdd3db1","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":99,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:49.360 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:49.620 [[32minfo[39m]: POST /2fa/setup 200 259ms {"requestId":"5eb805f0-baa4-44dd-9473-68373335bcdc","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":259,"ip":"::ffff:127.0.0.1","userId":"69949a11c59156f74c1409e0","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3352}
2026-02-17 11:40:49.622 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:40:49.633 [[32minfo[39m]: POST /2fa/verify 200 11ms {"requestId":"44599fa5-64d9-4be4-8d49-b138ee025d8f","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":200,"duration":11,"ip":"::ffff:127.0.0.1","userId":"69949a11c59156f74c1409e0","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":954}
2026-02-17 11:40:49.643 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:49.736 [[32minfo[39m]: POST /register 201 93ms {"requestId":"c0643bf0-e893-42d7-99dd-8045b197f3cf","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":93,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:49.738 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:50.017 [[32minfo[39m]: POST /2fa/setup 200 279ms {"requestId":"c9e1f197-1ff3-4d1b-8f95-467054010ce3","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":279,"ip":"::ffff:127.0.0.1","userId":"69949a11c59156f74c1409f2","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3304}
2026-02-17 11:40:50.020 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:40:50.025 [[33mwarn[39m]: POST /2fa/verify 400 5ms {"requestId":"7ed1a571-b2d0-4c3e-9dde-5d7bc66030f9","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":400,"duration":5,"ip":"::ffff:127.0.0.1","userId":"69949a11c59156f74c1409f2","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":47}
2026-02-17 11:40:50.042 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:50.139 [[32minfo[39m]: POST /register 201 97ms {"requestId":"1bb18fe0-069d-414e-af63-75c654cfe238","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":97,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:50.141 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:50.395 [[32minfo[39m]: POST /2fa/setup 200 255ms {"requestId":"5c82faf6-719f-4fcc-b415-8c79a02e00a0","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":255,"ip":"::ffff:127.0.0.1","userId":"69949a12c59156f74c140a03","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3276}
2026-02-17 11:40:50.397 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:40:50.398 [[33mwarn[39m]: POST /2fa/verify 401 1ms {"requestId":"76e0e987-6a65-411f-85c2-dc6d49f2fd01","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":401,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:40:50.408 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:50.495 [[32minfo[39m]: POST /register 201 88ms {"requestId":"09e9b98e-f5cf-438c-8b9a-ed83e1a8e834","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":88,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:50.497 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:50.779 [[32minfo[39m]: POST /2fa/setup 200 282ms {"requestId":"db28b431-c4f6-403f-ac44-7702c219569e","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":282,"ip":"::ffff:127.0.0.1","userId":"69949a12c59156f74c140a11","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3284}
2026-02-17 11:40:50.782 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:40:50.784 [[33mwarn[39m]: POST /2fa/verify 400 2ms {"requestId":"ba21e8e4-be18-409f-bbef-03f001486c00","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a12c59156f74c140a11","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":29}
2026-02-17 11:40:50.795 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:50.892 [[32minfo[39m]: POST /register 201 97ms {"requestId":"b6416da5-58a2-429f-87b2-232290402322","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":97,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:50.899 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/status:::ffff:127.0.0.1"}
2026-02-17 11:40:50.904 [[32minfo[39m]: GET /2fa/status 200 5ms {"requestId":"20722b81-eed9-4292-b008-850c584f3ac6","method":"GET","path":"/2fa/status","url":"/api/auth/2fa/status","statusCode":200,"duration":5,"ip":"::ffff:127.0.0.1","userId":"69949a12c59156f74c140a20","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":17}
2026-02-17 11:40:50.920 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:51.014 [[32minfo[39m]: POST /register 201 94ms {"requestId":"8e694fe5-33dd-48c3-8cd7-bf82c9c02e73","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":94,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:51.016 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:51.271 [[32minfo[39m]: POST /2fa/setup 200 255ms {"requestId":"b813022f-e6b9-4d6e-9dd2-976f793394a5","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":255,"ip":"::ffff:127.0.0.1","userId":"69949a12c59156f74c140a2e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3276}
2026-02-17 11:40:51.273 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:40:51.284 [[32minfo[39m]: POST /2fa/verify 200 11ms {"requestId":"3b03faf1-fcd8-42ce-8ade-ee9f8998b50a","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":200,"duration":11,"ip":"::ffff:127.0.0.1","userId":"69949a12c59156f74c140a2e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":954}
2026-02-17 11:40:51.285 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/status:::ffff:127.0.0.1"}
2026-02-17 11:40:51.287 [[32minfo[39m]: GET /2fa/status 200 2ms {"requestId":"6c412546-7992-417c-8613-950778f83ded","method":"GET","path":"/2fa/status","url":"/api/auth/2fa/status","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a12c59156f74c140a2e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":16}
2026-02-17 11:40:51.295 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:51.386 [[32minfo[39m]: POST /register 201 91ms {"requestId":"22004d1d-9581-4b85-bddc-a930aad53956","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":91,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:51.387 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/status:::ffff:127.0.0.1"}
2026-02-17 11:40:51.387 [[33mwarn[39m]: GET /2fa/status 401 0ms {"requestId":"7e257f93-1f49-41bb-8299-98456956fe13","method":"GET","path":"/2fa/status","url":"/api/auth/2fa/status","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:40:51.394 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:51.485 [[32minfo[39m]: POST /register 201 91ms {"requestId":"412e255d-7a25-4808-8632-ba8c79f080c8","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":91,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:51.486 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:51.749 [[32minfo[39m]: POST /2fa/setup 200 263ms {"requestId":"73806b38-9ff3-43e7-a153-7f9a4cedfa32","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":263,"ip":"::ffff:127.0.0.1","userId":"69949a13c59156f74c140a4e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3236}
2026-02-17 11:40:51.751 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:40:51.759 [[32minfo[39m]: POST /2fa/verify 200 8ms {"requestId":"147c4b5b-7fa0-408f-9b97-47c145080881","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":200,"duration":8,"ip":"::ffff:127.0.0.1","userId":"69949a13c59156f74c140a4e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":954}
2026-02-17 11:40:51.761 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify-login:::ffff:127.0.0.1"}
2026-02-17 11:40:51.761 [[33mwarn[39m]: POST /2fa/verify-login 429 0ms {"requestId":"4ee53848-718a-4242-b18d-46443e0a3c85","method":"POST","path":"/2fa/verify-login","url":"/api/auth/2fa/verify-login","statusCode":429,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":111}
2026-02-17 11:40:51.769 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:51.858 [[32minfo[39m]: POST /register 201 89ms {"requestId":"b3bcea93-3995-41a9-a395-3136411ad797","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":89,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:51.860 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:52.120 [[32minfo[39m]: POST /2fa/setup 200 260ms {"requestId":"82bf00f8-40b4-437a-b264-3614e9b9e649","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":200,"duration":260,"ip":"::ffff:127.0.0.1","userId":"69949a13c59156f74c140a60","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":3300}
2026-02-17 11:40:52.122 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/verify:::ffff:127.0.0.1"}
2026-02-17 11:40:52.124 [[33mwarn[39m]: POST /2fa/verify 429 2ms {"requestId":"40205056-8a39-4df4-8f59-82f662bc730c","method":"POST","path":"/2fa/verify","url":"/api/auth/2fa/verify","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a13c59156f74c140a60","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":111}
2026-02-17 11:40:52.133 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:52.225 [[32minfo[39m]: POST /register 201 92ms {"requestId":"159dff00-91de-49b2-a854-7f6b203e8e79","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":92,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:52.226 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:52.228 [[33mwarn[39m]: POST /2fa/setup 429 2ms {"requestId":"8919f4e9-4f0c-4210-aa3f-5bdadf9f0ff6","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a14c59156f74c140a6f","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:52.236 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:52.322 [[32minfo[39m]: POST /register 201 86ms {"requestId":"168f0f24-9a02-4778-9a65-99b00b10880c","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":86,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:52.324 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:52.326 [[33mwarn[39m]: POST /2fa/setup 429 2ms {"requestId":"597a531f-6b4f-4ea6-8bb5-de540eff4bc7","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a14c59156f74c140a7b","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:52.333 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:52.422 [[32minfo[39m]: POST /register 201 89ms {"requestId":"28d06795-be57-401c-8a83-cf1726b2af15","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":89,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:52.424 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:52.425 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"52907200-bc88-4599-9f18-d035e5355a23","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a14c59156f74c140a87","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:52.433 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:52.522 [[32minfo[39m]: POST /register 201 89ms {"requestId":"e5cb35ff-b6e2-499f-951b-e0cb4eff43a4","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":89,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:52.524 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:52.525 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"8358d403-f83c-457f-bf8a-cf4984c66825","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a14c59156f74c140a93","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:52.534 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:52.785 [[32minfo[39m]: POST /register 201 251ms {"requestId":"3d115b1a-f042-4f4b-a758-0f87ad218929","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":251,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:52.787 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:52.791 [[33mwarn[39m]: POST /2fa/setup 429 3ms {"requestId":"98dca87c-091e-4283-a2fa-9b2c4b3ab1e0","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a14c59156f74c140a9f","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:52.803 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:52.933 [[32minfo[39m]: POST /register 201 130ms {"requestId":"81083db2-8941-4b0a-85ae-17d4131bf518","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":130,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:52.934 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:52.938 [[33mwarn[39m]: POST /2fa/setup 429 4ms {"requestId":"d377e0bb-7161-4068-aaab-0ddf852ce7a6","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":4,"ip":"::ffff:127.0.0.1","userId":"69949a14c59156f74c140aab","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:52.954 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:53.060 [[32minfo[39m]: POST /register 201 106ms {"requestId":"b0f9a59b-7fb4-48ed-9b60-658fa8194246","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":106,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:53.061 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:53.063 [[33mwarn[39m]: POST /2fa/setup 429 2ms {"requestId":"a7286ca6-1c0a-4012-8d8f-061941b1399a","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a14c59156f74c140ab7","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:53.071 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:53.164 [[32minfo[39m]: POST /register 201 93ms {"requestId":"7e8da36a-3432-48fb-add6-1613167e6c79","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":93,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:53.167 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:53.169 [[33mwarn[39m]: POST /2fa/setup 429 2ms {"requestId":"6971bffe-9d1e-4365-9e5f-97c6e2e9e7e5","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a15c59156f74c140ac3","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:53.177 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:53.269 [[32minfo[39m]: POST /register 201 92ms {"requestId":"aa6286cb-a9e7-421e-aaa8-540a887736ee","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":92,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:53.271 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:53.272 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"4f1c6ddb-675f-4ef2-b010-f6c5f3cb90c2","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a15c59156f74c140acf","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:53.280 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:53.368 [[32minfo[39m]: POST /register 201 88ms {"requestId":"cd79d8ee-ede9-4818-b373-24dc296b234d","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":88,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:53.370 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:53.371 [[33mwarn[39m]: POST /2fa/setup 429 1ms {"requestId":"37bfe787-704d-4bd5-8413-baf459f72fad","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a15c59156f74c140adb","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
2026-02-17 11:40:53.379 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:53.468 [[32minfo[39m]: POST /register 201 89ms {"requestId":"dad151c7-0109-4db8-ba7c-69a6387379dd","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":89,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":714}
2026-02-17 11:40:53.476 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/2fa/setup:::ffff:127.0.0.1"}
2026-02-17 11:40:53.479 [[33mwarn[39m]: POST /2fa/setup 429 3ms {"requestId":"0229cb14-94f9-45f6-aa5a-7168987d619a","method":"POST","path":"/2fa/setup","url":"/api/auth/2fa/setup","statusCode":429,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a15c59156f74c140ae7","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":114}
FAIL src/__tests__/integration/two-factor-auth.test.js (7.846 s)
  Two-Factor Authentication Integration Tests
    POST /api/auth/2fa/setup
      âœ“ should generate 2FA QR code and secret for authenticated user (485 ms)
      âœ• should require authentication (109 ms)
      âœ“ should generate different secrets for multiple calls (621 ms)
    POST /api/auth/2fa/verify
      âœ• should enable 2FA with valid token and generate backup codes (384 ms)
      âœ• should reject invalid token (392 ms)
      âœ• should require authentication (372 ms)
      âœ“ should require token parameter (387 ms)
    GET /api/auth/2fa/status
      âœ“ should return disabled status when 2FA is not enabled (119 ms)
      âœ“ should return enabled status when 2FA is enabled (383 ms)
      âœ• should require authentication (100 ms)
    POST /api/auth/2fa/verify-login
      âœ• should complete login with valid 2FA token (374 ms)
      âœ• should reject invalid 2FA token (363 ms)
      âœ• should reject invalid credentials (103 ms)
      âœ• should accept valid backup code (98 ms)
      âœ• should reject already-used backup code (99 ms)
      âœ• should require all parameters (100 ms)
    POST /api/auth/2fa/disable
      âœ• should disable 2FA with valid password (265 ms)
      âœ• should reject invalid password (151 ms)
      âœ• should require password parameter (121 ms)
      âœ• should require authentication (107 ms)
    Login Flow with 2FA
      âœ• should require 2FA verification during login when enabled (103 ms)
      âœ• should complete full login flow with 2FA (98 ms)
      âœ• should allow normal login after disabling 2FA (107 ms)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/setup â€º should require authentication

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Access token required"
    Received value: "No token provided. Please login to access this resource."

      79 |         .expect(401);
      80 |
    > 81 |       expect(res.body).toHaveProperty('error', 'Access token required');
         |                        ^
      82 |     });
      83 |
      84 |     it('should generate different secrets for multiple calls', async () => {

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:81:24)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify â€º should enable 2FA with valid token and generate backup codes

    TypeError: expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has type:  object
    Received has value: {"code": "a70d019d105fd218283088180774a17c13894f52c478c3e0ff0ccd22e5a5419a", "usedAt": null}

      125 |       // Each backup code should be 8 characters
      126 |       res.body.backupCodes.forEach(code => {
    > 127 |         expect(code).toHaveLength(8);
          |                      ^
      128 |         expect(code).toMatch(/^[A-Z0-9]{8}$/);
      129 |       });
      130 |

      at src/__tests__/integration/two-factor-auth.test.js:127:22
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:126:28)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify â€º should reject invalid token

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Invalid 2FA code"
    Received value: "Secret is required for verification"

      143 |         .expect(400);
      144 |
    > 145 |       expect(res.body).toHaveProperty('error', 'Invalid 2FA code');
          |                        ^
      146 |
      147 |       // Verify 2FA was not enabled
      148 |       const user = await User.findById(testUser._id);

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:145:24)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify â€º should require authentication

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Access token required"
    Received value: "No token provided. Please login to access this resource."

      158 |         .expect(401);
      159 |
    > 160 |       expect(res.body).toHaveProperty('error', 'Access token required');
          |                        ^
      161 |     });
      162 |
      163 |     it('should require token parameter', async () => {

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:160:24)

  â— Two-Factor Authentication Integration Tests â€º GET /api/auth/2fa/status â€º should require authentication

    expect(received).toHaveProperty(path, value)

    Expected path: "error"

    Expected value: "Access token required"
    Received value: "No token provided. Please login to access this resource."

      211 |         .expect(401);
      212 |
    > 213 |       expect(res.body).toHaveProperty('error', 'Access token required');
          |                        ^
      214 |     });
      215 |   });
      216 |

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:213:24)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify-login â€º should complete login with valid 2FA token

    expected 200 "OK", got 429 "Too Many Requests"

      244 |           token,
      245 |         })
    > 246 |         .expect(200);
          |          ^
      247 |
      248 |       expect(res.body).toHaveProperty('accessToken');
      249 |       expect(res.body).toHaveProperty('refreshToken');

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:246:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify-login â€º should reject invalid 2FA token

    expected 200 "OK", got 429 "Too Many Requests"

      231 |         .set('Authorization', `Bearer ${accessToken}`)
      232 |         .send({ token, secret: twoFactorSecret })
    > 233 |         .expect(200);
          |          ^
      234 |     });
      235 |
      236 |     it('should complete login with valid 2FA token', async () => {

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:233:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify-login â€º should reject invalid credentials

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify-login â€º should accept valid backup code

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify-login â€º should reject already-used backup code

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/verify-login â€º should require all parameters

    expected 200 "OK", got 429 "Too Many Requests"

      221 |         .post('/api/auth/2fa/setup')
      222 |         .set('Authorization', `Bearer ${accessToken}`)
    > 223 |         .expect(200);
          |          ^
      224 |       
      225 |       twoFactorSecret = setupRes.body.secret;
      226 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:223:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/disable â€º should disable 2FA with valid password

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/disable â€º should reject invalid password

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/disable â€º should require password parameter

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º POST /api/auth/2fa/disable â€º should require authentication

    expected 200 "OK", got 429 "Too Many Requests"

      361 |         .post('/api/auth/2fa/setup')
      362 |         .set('Authorization', `Bearer ${accessToken}`)
    > 363 |         .expect(200);
          |          ^
      364 |       
      365 |       const token = generateToken(setupRes.body.secret);
      366 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:363:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º Login Flow with 2FA â€º should require 2FA verification during login when enabled

    expected 200 "OK", got 429 "Too Many Requests"

      428 |         .post('/api/auth/2fa/setup')
      429 |         .set('Authorization', `Bearer ${accessToken}`)
    > 430 |         .expect(200);
          |          ^
      431 |       
      432 |       twoFactorSecret = setupRes.body.secret;
      433 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:430:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º Login Flow with 2FA â€º should complete full login flow with 2FA

    expected 200 "OK", got 429 "Too Many Requests"

      428 |         .post('/api/auth/2fa/setup')
      429 |         .set('Authorization', `Bearer ${accessToken}`)
    > 430 |         .expect(200);
          |          ^
      431 |       
      432 |       twoFactorSecret = setupRes.body.secret;
      433 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:430:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— Two-Factor Authentication Integration Tests â€º Login Flow with 2FA â€º should allow normal login after disabling 2FA

    expected 200 "OK", got 429 "Too Many Requests"

      428 |         .post('/api/auth/2fa/setup')
      429 |         .set('Authorization', `Bearer ${accessToken}`)
    > 430 |         .expect(200);
          |          ^
      431 |       
      432 |       twoFactorSecret = setupRes.body.secret;
      433 |       

      at Object.<anonymous> (src/__tests__/integration/two-factor-auth.test.js:430:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:40:56.173 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:56.292 [[32minfo[39m]: POST /register 201 120ms {"requestId":"4c597050-66cd-40fa-8f2d-0b7a6e02b02a","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":120,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:56.296 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:56.522 [[32minfo[39m]: PATCH /password 200 226ms {"requestId":"dff27d61-b987-4dbd-ad62-23a293d3d2f8","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":226,"ip":"::ffff:127.0.0.1","userId":"69949a186b5efb6518620034","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:40:56.526 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:56.611 [[32minfo[39m]: POST /login 200 85ms {"requestId":"ba0814ea-7be1-4d32-8582-76379865ae7e","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":85,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:56.621 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:56.708 [[32minfo[39m]: POST /register 201 87ms {"requestId":"afebea87-d12e-4be2-a33f-edf4a2826c4f","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":87,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:56.709 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:56.927 [[32minfo[39m]: PATCH /password 200 218ms {"requestId":"52bcff46-4ab5-457f-b850-ef047eb120b3","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":218,"ip":"::ffff:127.0.0.1","userId":"69949a186b5efb651862004a","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:40:56.929 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:57.003 [[33mwarn[39m]: POST /login 401 73ms {"requestId":"fc58dc7d-da29-4b8b-9665-8975985d786a","method":"POST","path":"/login","url":"/api/auth/login","statusCode":401,"duration":73,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":54}
2026-02-17 11:40:57.011 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:57.100 [[32minfo[39m]: POST /register 201 89ms {"requestId":"0a962b96-1e62-430e-ba93-a45c727ded0d","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":89,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:57.102 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:57.175 [[33mwarn[39m]: PATCH /password 400 73ms {"requestId":"fd824870-a39d-4a49-a061-e833fcdb8328","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":73,"ip":"::ffff:127.0.0.1","userId":"69949a196b5efb651862005b","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:40:57.184 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:57.275 [[32minfo[39m]: POST /register 201 91ms {"requestId":"bda8afc4-f614-420f-98d1-e296116d43dc","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":91,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:57.277 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:57.279 [[33mwarn[39m]: PATCH /password 400 2ms {"requestId":"71430522-5c12-4f86-a77f-3c8283b90bf1","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a196b5efb6518620069","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":71}
2026-02-17 11:40:57.286 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:57.375 [[32minfo[39m]: POST /register 201 89ms {"requestId":"1a93f18f-7c7a-4d29-ab68-924f2dfd2cfd","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":89,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:57.377 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:57.515 [[33mwarn[39m]: PATCH /password 400 138ms {"requestId":"2b1a7421-a98c-4a79-86bc-e57c66d886a7","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":138,"ip":"::ffff:127.0.0.1","userId":"69949a196b5efb6518620075","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":81}
2026-02-17 11:40:57.524 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:57.612 [[32minfo[39m]: POST /register 201 88ms {"requestId":"0099a839-ce1f-42c9-865d-8a866176e876","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":88,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:57.614 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:57.614 [[33mwarn[39m]: PATCH /password 401 0ms {"requestId":"2be1d581-fbf9-4e65-b73e-5b0568120a99","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:40:57.622 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:57.731 [[32minfo[39m]: POST /register 201 109ms {"requestId":"15fe1ab9-ee86-4d24-a04c-843523b912ff","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":109,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:57.735 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:57.738 [[33mwarn[39m]: PATCH /password 400 3ms {"requestId":"2946f314-bfe1-451a-b918-d9300509a0ac","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a196b5efb651862008e","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":68}
2026-02-17 11:40:57.756 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:57.861 [[32minfo[39m]: POST /register 201 105ms {"requestId":"b279cd2e-6c81-47d8-8256-aa993a2a1a27","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":105,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:57.863 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:58.109 [[32minfo[39m]: PATCH /password 200 246ms {"requestId":"0fbf7f1d-a12a-4d72-b85a-2c28eab26f13","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":246,"ip":"::ffff:127.0.0.1","userId":"69949a196b5efb651862009a","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:40:58.110 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/me:::ffff:127.0.0.1"}
2026-02-17 11:40:58.112 [[32minfo[39m]: GET /me 200 2ms {"requestId":"a55b6125-2692-4dc7-963e-c8cc721a0b06","method":"GET","path":"/me","url":"/api/auth/me","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a196b5efb651862009a","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":320}
2026-02-17 11:40:58.121 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:58.207 [[32minfo[39m]: POST /register 201 86ms {"requestId":"a82abfdf-31c6-478e-80ab-bfcae2556a6d","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":86,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:58.209 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:58.296 [[32minfo[39m]: DELETE /account 200 87ms {"requestId":"297b1415-d0cc-416a-a980-ab9d58de9ef4","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":87,"ip":"::ffff:127.0.0.1","userId":"69949a1a6b5efb65186200aa","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:40:58.311 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:58.394 [[32minfo[39m]: POST /register 201 83ms {"requestId":"d53b0bd6-08ac-400c-9061-9471d29885ce","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":83,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:58.396 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:58.469 [[32minfo[39m]: DELETE /account 200 73ms {"requestId":"1d56e5d2-a928-4b3a-9b8b-84a6d104db38","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":73,"ip":"::ffff:127.0.0.1","userId":"69949a1a6b5efb65186200bf","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:40:58.470 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:40:58.471 [[33mwarn[39m]: POST /login 401 1ms {"requestId":"c82e06d6-502b-4751-917d-2f6344c68373","method":"POST","path":"/login","url":"/api/auth/login","statusCode":401,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":54}
2026-02-17 11:40:58.475 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:58.556 [[32minfo[39m]: POST /register 201 81ms {"requestId":"c8b99b27-aef7-4161-a880-19855687836a","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":81,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:58.572 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:58.647 [[32minfo[39m]: DELETE /account 200 75ms {"requestId":"e3990947-9f3c-4fc1-9480-1e07d895de02","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":75,"ip":"::ffff:127.0.0.1","userId":"69949a1a6b5efb65186200d4","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:40:58.651 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:58.755 [[32minfo[39m]: POST /register 201 104ms {"requestId":"0d067b26-33e2-4e02-bf9c-9927a13f3f25","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":104,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:58.767 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:58.852 [[32minfo[39m]: DELETE /account 200 85ms {"requestId":"8345322a-1b1c-4f24-bf91-c9590e6a3fc9","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":85,"ip":"::ffff:127.0.0.1","userId":"69949a1a6b5efb65186200f0","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:40:58.860 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:58.950 [[32minfo[39m]: POST /register 201 90ms {"requestId":"33a8cb93-8b3c-47ed-9945-9346e4ec86eb","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":90,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:58.964 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:59.051 [[32minfo[39m]: POST /register 201 87ms {"requestId":"e2a7db23-86cd-441a-8e73-0cad6a53a7e9","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":87,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:59.058 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:59.135 [[32minfo[39m]: DELETE /account 200 77ms {"requestId":"b7ec4185-d11f-45a7-ab65-f58562ce848d","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":77,"ip":"::ffff:127.0.0.1","userId":"69949a1a6b5efb6518620118","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
2026-02-17 11:40:59.139 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:59.216 [[32minfo[39m]: POST /register 201 77ms {"requestId":"577aecaf-1cc3-47dd-bfd6-241fc5cc1cbc","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":77,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:59.218 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:59.282 [[33mwarn[39m]: DELETE /account 400 64ms {"requestId":"b72312ad-cab6-48cb-8299-50ac18b00bc3","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":400,"duration":64,"ip":"::ffff:127.0.0.1","userId":"69949a1b6b5efb6518620132","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":50}
2026-02-17 11:40:59.292 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:59.375 [[32minfo[39m]: POST /register 201 83ms {"requestId":"fd1bd7d8-1016-43c9-b4ac-429a839c9782","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":83,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:59.380 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:59.380 [[33mwarn[39m]: DELETE /account 401 0ms {"requestId":"f2216be0-60e8-48d2-9703-0a951662173e","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:40:59.388 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:59.468 [[32minfo[39m]: POST /register 201 79ms {"requestId":"ed34d853-4185-40a9-841f-7734a3a851be","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":79,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:59.469 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:59.470 [[33mwarn[39m]: DELETE /account 400 1ms {"requestId":"f85b6f57-829d-4114-8115-28f7a5771193","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a1b6b5efb651862014d","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":72}
2026-02-17 11:40:59.476 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/register:::ffff:127.0.0.1"}
  console.error
    Failed to send verification email: Error: Email service not initialized. Call initializeEmailService() first.
        at sendVerificationEmail (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/services/emailService.js:179:11)
        at register (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/authController.js:64:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      71 |     } catch (emailError) {
      72 |       // Log error but don't fail registration
    > 73 |       console.error('Failed to send verification email:', emailError);
         |               ^
      74 |     }
      75 |
      76 |     res.status(201).json({

      at register (src/controllers/authController.js:73:15)

2026-02-17 11:40:59.556 [[32minfo[39m]: POST /register 201 80ms {"requestId":"2140e747-4755-4d56-a696-a5881adc0810","method":"POST","path":"/register","url":"/api/auth/register","statusCode":201,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":707}
2026-02-17 11:40:59.568 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/password:::ffff:127.0.0.1"}
2026-02-17 11:40:59.799 [[32minfo[39m]: PATCH /password 200 231ms {"requestId":"2f30904a-31e2-42e3-91e9-87f77c7716c2","method":"PATCH","path":"/password","url":"/api/auth/password","statusCode":200,"duration":231,"ip":"::ffff:127.0.0.1","userId":"69949a1b6b5efb6518620159","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":59}
2026-02-17 11:40:59.801 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/me:::ffff:127.0.0.1"}
2026-02-17 11:40:59.803 [[32minfo[39m]: GET /me 200 2ms {"requestId":"8a4984f6-969d-40db-bf58-e182aab5d4e3","method":"GET","path":"/me","url":"/api/auth/me","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a1b6b5efb6518620159","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":320}
2026-02-17 11:40:59.805 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/account:::ffff:127.0.0.1"}
2026-02-17 11:40:59.899 [[32minfo[39m]: DELETE /account 200 94ms {"requestId":"39a0643b-77c8-49a7-b64e-0670c399fa79","method":"DELETE","path":"/account","url":"/api/auth/account","statusCode":200,"duration":94,"ip":"::ffff:127.0.0.1","userId":"69949a1b6b5efb6518620159","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":58}
FAIL src/__tests__/integration/account-management.test.js (6.393 s)
  Account Management - Update Password
    âœ“ should update password successfully (478 ms)
    âœ“ should verify old password no longer works after update (391 ms)
    âœ“ should reject incorrect current password (173 ms)
    âœ“ should reject weak new password (104 ms)
    âœ“ should reject new password same as current (236 ms)
    âœ“ should reject request without authentication (98 ms)
    âœ“ should reject missing fields (125 ms)
    âœ“ should keep session active after password change (373 ms)
  Account Management - Delete Account
    âœ“ should delete account successfully (185 ms)
    âœ“ should prevent login after account deletion (173 ms)
    âœ“ should delete all user recipes on account deletion (176 ms)
    âœ“ should delete all user collections on account deletion (206 ms)
    âœ• should delete all user meal plans on account deletion (98 ms)
    âœ“ should delete all user shopping lists on account deletion (180 ms)
    âœ“ should reject incorrect password for account deletion (148 ms)
    âœ“ should reject request without authentication (96 ms)
    âœ“ should reject missing password (90 ms)
  Account Management - Complete Flow
    âœ“ should complete full account lifecycle (432 ms)

  â— Account Management - Delete Account â€º should delete all user meal plans on account deletion

    ValidationError: MealPlan validation failed: endDate: End date must be after start date

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:41:02.512 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:41:02.596 [[32minfo[39m]: POST /login 200 84ms {"requestId":"3cb85be4-0555-47f9-9f5d-600d9eed8c23","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":84,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":711}
FAIL src/__tests__/integration/meal-planning.test.js
  Meal Planning API Integration Tests
    POST /api/meal-plans
      âœ• should create a new meal plan (2 ms)
      âœ• should reject meal plans longer than 28 days (2 ms)
      âœ• should detect overlapping meal plans (1 ms)
      âœ• should require authentication
    GET /api/meal-plans
      âœ• should get all meal plans for authenticated user
      âœ• should filter templates when requested (2 ms)
    POST /api/meal-plans/:id/meals
      âœ• should add a meal to the plan (1 ms)
      âœ• should reject invalid recipe ID
      âœ• should add multiple recipes to same meal
    DELETE /api/meal-plans/:id/meals/:mealId
      âœ• should remove a meal from the plan (2 ms)
      âœ• should return 404 for non-existent meal (1 ms)
    GET /api/meal-plans/:id/shopping-list
      âœ• should generate shopping list from meal plan
    POST /api/meal-plans/:id/duplicate
      âœ• should duplicate as template (1 ms)
      âœ• should duplicate to new dates (1 ms)
      âœ• should reject duplicate if dates overlap (1 ms)
    DELETE /api/meal-plans/:id
      âœ• should delete a meal plan (1 ms)
      âœ• should not allow deleting other users meal plans
    PUT /api/meal-plans/:id
      âœ• should update meal plan details (1 ms)
      âœ• should detect overlaps when updating dates (2 ms)

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans â€º should create a new meal plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans â€º should reject meal plans longer than 28 days

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans â€º should detect overlapping meal plans

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans â€º should require authentication

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º GET /api/meal-plans â€º should get all meal plans for authenticated user

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º GET /api/meal-plans â€º should filter templates when requested

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans/:id/meals â€º should add a meal to the plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans/:id/meals â€º should reject invalid recipe ID

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans/:id/meals â€º should add multiple recipes to same meal

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º DELETE /api/meal-plans/:id/meals/:mealId â€º should remove a meal from the plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º DELETE /api/meal-plans/:id/meals/:mealId â€º should return 404 for non-existent meal

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º GET /api/meal-plans/:id/shopping-list â€º should generate shopping list from meal plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans/:id/duplicate â€º should duplicate as template

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans/:id/duplicate â€º should duplicate to new dates

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º POST /api/meal-plans/:id/duplicate â€º should reject duplicate if dates overlap

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º DELETE /api/meal-plans/:id â€º should delete a meal plan

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º DELETE /api/meal-plans/:id â€º should not allow deleting other users meal plans

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º PUT /api/meal-plans/:id â€º should update meal plan details

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Meal Planning API Integration Tests â€º PUT /api/meal-plans/:id â€º should detect overlaps when updating dates

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:41:04.719 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:41:04.798 [[32minfo[39m]: POST /login 200 80ms {"requestId":"c28adc84-901e-4f0f-bfa2-187b4fff9d2c","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":80,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":713}
2026-02-17 11:41:04.804 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.810 [[33mwarn[39m]: POST /backup 400 6ms {"requestId":"fae82d32-9060-4a57-85e6-20fc647799ac","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":4,"limit":5},"responseSize":102}
2026-02-17 11:41:04.815 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.820 [[31merror[39m]: Request error {"requestId":"aad3be45-b18b-493f-a452-d37143bfe31b","error":"Must be .json file","stack":"ImportError: Must be .json file\n    at fileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/importController.js:36:9)\n    at wrappedFileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/index.js:44:7)\n    at Multipart.<anonymous> (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/lib/make-middleware.js:109:7)\n    at Multipart.emit (node:events:507:28)\n    at HeaderParser.cb (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:358:14)\n    at HeaderParser.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:162:20)\n    at SBMH.ssCb [as _cb] (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:394:37)\n    at feed (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:219:14)\n    at SBMH.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:104:16)\n    at Multipart._write (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:567:19)\n    at writeOrBuffer (node:internal/streams/writable:570:12)\n    at _write (node:internal/streams/writable:499:10)\n    at Multipart.Writable.write (node:internal/streams/writable:508:10)\n    at IncomingMessage.ondata (node:internal/streams/readable:1008:24)\n    at IncomingMessage.emit (node:events:507:28)\n    at IncomingMessage.Readable.read (node:internal/streams/readable:780:10)\n    at flow (node:internal/streams/readable:1286:53)\n    at resume_ (node:internal/streams/readable:1265:3)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","method":"POST","path":"/api/import/backup","userId":"69949a206d3bacee84df9273","ip":"::ffff:127.0.0.1"}
2026-02-17 11:41:04.820 [[31merror[39m]: Unhandled error {"requestId":"aad3be45-b18b-493f-a452-d37143bfe31b","error":"Must be .json file","stack":"ImportError: Must be .json file\n    at fileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/src/controllers/importController.js:36:9)\n    at wrappedFileFilter (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/index.js:44:7)\n    at Multipart.<anonymous> (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/multer/lib/make-middleware.js:109:7)\n    at Multipart.emit (node:events:507:28)\n    at HeaderParser.cb (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:358:14)\n    at HeaderParser.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:162:20)\n    at SBMH.ssCb [as _cb] (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:394:37)\n    at feed (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:219:14)\n    at SBMH.push (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/streamsearch/lib/sbmh.js:104:16)\n    at Multipart._write (/Users/scott.carroll/Development/copilot-testing/recipe-book/backend/node_modules/busboy/lib/types/multipart.js:567:19)\n    at writeOrBuffer (node:internal/streams/writable:570:12)\n    at _write (node:internal/streams/writable:499:10)\n    at Multipart.Writable.write (node:internal/streams/writable:508:10)\n    at IncomingMessage.ondata (node:internal/streams/readable:1008:24)\n    at IncomingMessage.emit (node:events:507:28)\n    at IncomingMessage.Readable.read (node:internal/streams/readable:780:10)\n    at flow (node:internal/streams/readable:1286:53)\n    at resume_ (node:internal/streams/readable:1265:3)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","path":"/api/import/backup","method":"POST"}
2026-02-17 11:41:04.820 [[31merror[39m]: POST /api/import/backup 500 5ms {"requestId":"aad3be45-b18b-493f-a452-d37143bfe31b","method":"POST","path":"/api/import/backup","url":"/api/import/backup","statusCode":500,"duration":5,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":3,"limit":5},"responseSize":1969}
2026-02-17 11:41:04.827 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.830 [[33mwarn[39m]: POST /backup 400 3ms {"requestId":"100ca9ba-35bc-4d41-9693-2b1549cae58f","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":2,"limit":5},"responseSize":133}
2026-02-17 11:41:04.834 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.836 [[33mwarn[39m]: POST /backup 400 2ms {"requestId":"1ede9d22-3779-45ed-804f-c2bc520953c1","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":1,"limit":5},"responseSize":195}
2026-02-17 11:41:04.840 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.842 [[33mwarn[39m]: POST /backup 400 2ms {"requestId":"446531d9-6d50-4d6b-a06d-a33dda7d71ab","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":205}
2026-02-17 11:41:04.846 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.847 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"1416e140-8eeb-416c-9433-b41daaf77933","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.853 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.855 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"b44ef88d-f62e-451b-97f6-71243e85a00d","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.860 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.862 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"617934b1-b727-458a-92b6-aee195325cc4","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.866 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.868 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"3a21fa58-5207-4309-982f-bbacd728bc9c","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.887 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.889 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"86cabd06-bbed-4c6b-b3fd-b8d3c703b71e","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.893 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.894 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"a65562da-0cbc-4ad8-9582-96ad27217765","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.901 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.902 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"8d56f59b-7b40-49b4-be91-c4e8001b0c92","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.905 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.907 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"dec75613-6c5d-4bbe-9d14-aaa4b337631f","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.910 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.912 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"ba5df6cb-6fcb-4806-a6b0-c78ff3e31794","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.915 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.916 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"d2ba900b-1f69-457b-b670-9690bd8be772","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.920 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.920 [[33mwarn[39m]: POST /backup 401 0ms {"requestId":"5ce4f1b0-ab8b-48c0-a2ea-89433e950090","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":401,"duration":0,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:41:04.923 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.925 [[33mwarn[39m]: POST /backup 429 2ms {"requestId":"17605784-076e-4a91-a1be-5c5136d60da0","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
2026-02-17 11:41:04.928 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/import/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:04.929 [[33mwarn[39m]: POST /backup 429 1ms {"requestId":"7cf92bfb-0cea-496c-b1ba-0c85b20e68f3","method":"POST","path":"/backup","url":"/api/import/backup","statusCode":429,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a206d3bacee84df9273","rateLimit":{"remaining":0,"limit":5},"responseSize":183}
FAIL src/__tests__/integration/import-backup.test.js
  Import from Backup - Integration Tests
    POST /api/import/backup - File Validation
      âœ“ should reject request with no file (11 ms)
      âœ• should reject non-JSON file (11 ms)
      âœ“ should reject invalid JSON (7 ms)
      âœ“ should reject backup missing required fields (7 ms)
      âœ“ should reject incompatible version (< 2.0.0) (6 ms)
    POST /api/import/backup - Content Validation
      âœ• should reject recipe missing title (6 ms)
      âœ• should reject recipe with empty ingredients (7 ms)
      âœ• should reject recipe with empty instructions (7 ms)
    POST /api/import/backup - Merge Mode
      âœ• should successfully import backup in merge mode (5 ms)
      âœ• should skip duplicates in merge mode (4 ms)
      âœ• should preserve existing data in merge mode (4 ms)
    POST /api/import/backup - Replace Mode
      âœ• should reject replace mode without password (6 ms)
      âœ• should reject replace mode with wrong password (5 ms)
      âœ• should delete all existing data in replace mode (2 ms)
    POST /api/import/backup - ID Remapping
      âœ• should remap recipe IDs in collections (5 ms)
      âœ• should remap recipe IDs in meal plans (5 ms)
      âœ• should handle missing recipe references gracefully (4 ms)
    POST /api/import/backup - Transaction Rollback
      âœ• should rollback on validation error (5 ms)
    POST /api/import/backup - Security
      âœ“ should require authentication (4 ms)
      âœ• should sanitize XSS in recipe titles (4 ms)
    POST /api/import/backup - Performance
      âœ• should complete import within reasonable time (4 ms)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - File Validation â€º should reject non-JSON file

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      159 |         .attach('file', Buffer.from('not json'), 'backup.txt');
      160 |
    > 161 |       expect(res.status).toBe(400);
          |                          ^
      162 |       expect(res.body.success).toBe(false);
      163 |     });
      164 |

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:161:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Content Validation â€º should reject recipe missing title

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      226 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      227 |
    > 228 |       expect(res.status).toBe(400);
          |                          ^
      229 |       expect(res.body.success).toBe(false);
      230 |       expect(res.body.details.code).toBe('INVALID_RECIPE');
      231 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:228:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Content Validation â€º should reject recipe with empty ingredients

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      252 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      253 |
    > 254 |       expect(res.status).toBe(400);
          |                          ^
      255 |       expect(res.body.success).toBe(false);
      256 |       expect(res.body.details.code).toBe('INVALID_RECIPE');
      257 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:254:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Content Validation â€º should reject recipe with empty instructions

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      278 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      279 |
    > 280 |       expect(res.status).toBe(400);
          |                          ^
      281 |       expect(res.body.success).toBe(false);
      282 |       expect(res.body.details.code).toBe('INVALID_RECIPE');
      283 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:280:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Merge Mode â€º should successfully import backup in merge mode

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      292 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      293 |
    > 294 |       expect(res.status).toBe(200);
          |                          ^
      295 |       expect(res.body.success).toBe(true);
      296 |       expect(res.body.summary).toMatchObject({
      297 |         mode: 'merge',

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:294:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Merge Mode â€º should skip duplicates in merge mode

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required., ingredients.1.name: Path `name` is required., ingredients.2.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Merge Mode â€º should preserve existing data in merge mode

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Replace Mode â€º should reject replace mode without password

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      379 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      380 |
    > 381 |       expect(res.status).toBe(400);
          |                          ^
      382 |       expect(res.body.success).toBe(false);
      383 |       expect(res.body.details.code).toBe('INVALID_PASSWORD');
      384 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:381:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Replace Mode â€º should reject replace mode with wrong password

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      392 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      393 |
    > 394 |       expect(res.status).toBe(400);
          |                          ^
      395 |       expect(res.body.success).toBe(false);
      396 |       expect(res.body.details.code).toBe('INVALID_PASSWORD');
      397 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:394:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Replace Mode â€º should delete all existing data in replace mode

    ValidationError: Recipe validation failed: ingredients.0.name: Path `name` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3381:32)
      at EmbeddedDocument.Subdocument.invalidate (node_modules/mongoose/lib/types/subdocument.js:257:12)
      at node_modules/mongoose/lib/document.js:3142:17
      at node_modules/mongoose/lib/schemaType.js:1446:9

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - ID Remapping â€º should remap recipe IDs in collections

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      442 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      443 |
    > 444 |       expect(res.status).toBe(200);
          |                          ^
      445 |
      446 |       // Get imported collection
      447 |       const collection = await Collection.findOne({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:444:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - ID Remapping â€º should remap recipe IDs in meal plans

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      462 |         .attach('file', Buffer.from(JSON.stringify(validBackupV2)), 'backup.json');
      463 |
    > 464 |       expect(res.status).toBe(200);
          |                          ^
      465 |
      466 |       // Get imported meal plan
      467 |       const mealPlan = await MealPlan.findOne({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:464:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - ID Remapping â€º should handle missing recipe references gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      503 |         );
      504 |
    > 505 |       expect(res.status).toBe(200);
          |                          ^
      506 |
      507 |       // Collection should only have valid reference
      508 |       const collection = await Collection.findOne({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:505:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Transaction Rollback â€º should rollback on validation error

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 429

      534 |         .attach('file', Buffer.from(JSON.stringify(invalidBackup)), 'backup.json');
      535 |
    > 536 |       expect(res.status).toBe(400);
          |                          ^
      537 |
      538 |       // Verify NO data was created (rollback successful)
      539 |       const recipes = await Recipe.find({ owner: userId });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:536:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Security â€º should sanitize XSS in recipe titles

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      576 |         .attach('file', Buffer.from(JSON.stringify(xssBackup)), 'backup.json');
      577 |
    > 578 |       expect(res.status).toBe(200);
          |                          ^
      579 |
      580 |       const recipe = await Recipe.findOne({ owner: userId });
      581 |       expect(recipe.title).not.toContain('<script>');

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:578:26)

  â— Import from Backup - Integration Tests â€º POST /api/import/backup - Performance â€º should complete import within reasonable time

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 429

      596 |       const duration = Date.now() - startTime;
      597 |
    > 598 |       expect(res.status).toBe(200);
          |                          ^
      599 |       expect(duration).toBeLessThan(5000); // Should complete in < 5s
      600 |       expect(res.body.summary.duration).toBeLessThan(5000);
      601 |     });

      at Object.<anonymous> (src/__tests__/integration/import-backup.test.js:598:26)

(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL src/__tests__/integration/password-reset.test.js
  Password Reset Integration Tests
    POST /api/auth/forgot-password
      âœ• should successfully request a password reset for existing user (1 ms)
      âœ• should not reveal if email does not exist (security)
      âœ• should reject invalid email format
      âœ• should reject missing email
      âœ• should handle rate limiting
    GET /api/auth/validate-reset-token
      âœ• should validate a valid reset token
      âœ• should reject invalid token format
      âœ• should reject expired token
      âœ• should reject token not in database
      âœ• should reject missing token (1 ms)
    POST /api/auth/reset-password
      âœ• should successfully reset password with valid token
      âœ• should be able to login with new password
      âœ• should not be able to use old password after reset
      âœ• should reject weak password
      âœ• should reject password without uppercase
      âœ• should reject password without number
      âœ• should reject invalid token
      âœ• should reject expired token
      âœ• should reject reusing the same token twice
      âœ• should reject missing password
      âœ• should reject missing token
    Complete Password Reset Flow
      âœ• should complete entire password reset flow successfully

  â— Password Reset Integration Tests â€º POST /api/auth/forgot-password â€º should successfully request a password reset for existing user

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/forgot-password â€º should not reveal if email does not exist (security)

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/forgot-password â€º should reject invalid email format

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/forgot-password â€º should reject missing email

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/forgot-password â€º should handle rate limiting

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º GET /api/auth/validate-reset-token â€º should validate a valid reset token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º GET /api/auth/validate-reset-token â€º should reject invalid token format

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º GET /api/auth/validate-reset-token â€º should reject expired token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º GET /api/auth/validate-reset-token â€º should reject token not in database

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º GET /api/auth/validate-reset-token â€º should reject missing token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should successfully reset password with valid token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should be able to login with new password

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should not be able to use old password after reset

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject weak password

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject password without uppercase

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject password without number

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject invalid token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject expired token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject reusing the same token twice

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject missing password

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º POST /api/auth/reset-password â€º should reject missing token

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

  â— Password Reset Integration Tests â€º Complete Password Reset Flow â€º should complete entire password reset flow successfully

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

      15 |     await ensureConnection();
      16 |     // Connect to test database
    > 17 |     await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/recipe-book-test');
         |                    ^
      18 |   });
      19 |
      20 |   beforeEach(async () => {

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1075:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/integration/password-reset.test.js:17:20)

(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL src/__tests__/integration/v1.1-features.test.js
  V1.1 Features Integration Tests
    Input Validation & Sanitization
      âœ• should reject recipe with missing required fields (27 ms)
      âœ• should reject recipe with title exceeding max length (7 ms)
      âœ• should sanitize HTML in recipe fields (4 ms)
      âœ• should validate numeric fields (3 ms)
      âœ• should validate dishType enum (3 ms)
      âœ• should validate rating range (4 ms)
      âœ• should validate URL format (2 ms)
      âœ• should accept valid recipe with all fields (3 ms)
    Pagination
      âœ• should return paginated results with default limit (42 ms)
      âœ• should return correct page with custom limit (33 ms)
      âœ• should return last page correctly (22 ms)
      âœ• should handle pagination with filters (27 ms)
    Caching
      âœ• should cache GET requests (12 ms)
      âœ• should clear cache on recipe creation (4 ms)
      âœ• should clear cache on recipe update (15 ms)
      âœ• should clear cache on recipe deletion (13 ms)
    Lock Recipe Feature
      âœ• should toggle recipe lock status (12 ms)
      âœ• should prevent deletion of locked recipe (13 ms)
      âœ• should allow deletion of unlocked recipe (12 ms)
    Error Handling
      âœ• should return 404 for non-existent recipe (2 ms)
      âœ• should handle invalid MongoDB ID format (2 ms)
      âœ“ should handle malformed JSON (5 ms)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should reject recipe with missing required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      32 |         });
      33 |
    > 34 |       expect(res.status).toBe(400);
         |                          ^
      35 |       expect(res.body.success).toBe(false);
      36 |       expect(res.body.error).toBe('Validation failed');
      37 |     });

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:34:26)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should reject recipe with title exceeding max length

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      47 |         });
      48 |
    > 49 |       expect(res.status).toBe(400);
         |                          ^
      50 |       expect(res.body.success).toBe(false);
      51 |     });
      52 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:49:26)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should sanitize HTML in recipe fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

      61 |         });
      62 |
    > 63 |       expect(res.status).toBe(201);
         |                          ^
      64 |       expect(res.body.data.title).not.toContain('<script>');
      65 |       expect(res.body.data.title).not.toContain('alert');
      66 |       expect(res.body.data.description).not.toContain('<b>');

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:63:26)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should validate numeric fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      80 |         });
      81 |
    > 82 |       expect(res.status).toBe(400);
         |                          ^
      83 |       expect(res.body.success).toBe(false);
      84 |     });
      85 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:82:26)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should validate dishType enum

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      94 |         });
      95 |
    > 96 |       expect(res.status).toBe(400);
         |                          ^
      97 |       expect(res.body.success).toBe(false);
      98 |     });
      99 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:96:26)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should validate rating range

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      108 |         });
      109 |
    > 110 |       expect(res.status).toBe(400);
          |                          ^
      111 |       expect(res.body.success).toBe(false);
      112 |     });
      113 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:110:26)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should validate URL format

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      122 |         });
      123 |
    > 124 |       expect(res.status).toBe(400);
          |                          ^
      125 |       expect(res.body.success).toBe(false);
      126 |     });
      127 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:124:26)

  â— V1.1 Features Integration Tests â€º Input Validation & Sanitization â€º should accept valid recipe with all fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

      149 |         .send(validRecipe);
      150 |
    > 151 |       expect(res.status).toBe(201);
          |                          ^
      152 |       expect(res.body.success).toBe(true);
      153 |       expect(res.body.data.title).toBe('Valid Recipe');
      154 |     });

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:151:26)

  â— V1.1 Features Integration Tests â€º Pagination â€º should return paginated results with default limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      169 |       const res = await request(app).get('/api/recipes');
      170 |
    > 171 |       expect(res.status).toBe(200);
          |                          ^
      172 |       expect(res.body.success).toBe(true);
      173 |       expect(res.body.data).toHaveLength(25); // Default limit is 50
      174 |       expect(res.body.pagination).toBeDefined();

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:171:26)

  â— V1.1 Features Integration Tests â€º Pagination â€º should return correct page with custom limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      182 |         .query({ page: 2, limit: 10 });
      183 |
    > 184 |       expect(res.status).toBe(200);
          |                          ^
      185 |       expect(res.body.data).toHaveLength(10);
      186 |       expect(res.body.pagination.currentPage).toBe(2);
      187 |       expect(res.body.pagination.limit).toBe(10);

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:184:26)

  â— V1.1 Features Integration Tests â€º Pagination â€º should return last page correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      196 |         .query({ page: 3, limit: 10 });
      197 |
    > 198 |       expect(res.status).toBe(200);
          |                          ^
      199 |       expect(res.body.data).toHaveLength(5); // Only 5 recipes on last page
      200 |       expect(res.body.pagination.hasNextPage).toBe(false);
      201 |       expect(res.body.pagination.hasPrevPage).toBe(true);

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:198:26)

  â— V1.1 Features Integration Tests â€º Pagination â€º should handle pagination with filters

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      215 |         .query({ cuisine: 'Italian', page: 1, limit: 10 });
      216 |
    > 217 |       expect(res.status).toBe(200);
          |                          ^
      218 |       expect(res.body.pagination.totalRecipes).toBe(1);
      219 |     });
      220 |   });

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:217:26)

  â— V1.1 Features Integration Tests â€º Caching â€º should cache GET requests

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      231 |       // First request (cache miss)
      232 |       const res1 = await request(app).get(`/api/recipes/${recipe._id}`);
    > 233 |       expect(res1.status).toBe(200);
          |                           ^
      234 |
      235 |       // Second request (should be cached)
      236 |       const res2 = await request(app).get(`/api/recipes/${recipe._id}`);

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:233:27)

  â— V1.1 Features Integration Tests â€º Caching â€º should clear cache on recipe creation

    TypeError: Cannot read properties of undefined (reading 'length')

      254 |       // Get list again (should reflect new recipe)
      255 |       const res = await request(app).get('/api/recipes');
    > 256 |       expect(res.body.data.length).toBe(1);
          |                            ^
      257 |     });
      258 |
      259 |     test('should clear cache on recipe update', async () => {

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:256:28)

  â— V1.1 Features Integration Tests â€º Caching â€º should clear cache on recipe update

    TypeError: Cannot read properties of undefined (reading 'title')

      278 |       // Get recipe again
      279 |       const res = await request(app).get(`/api/recipes/${recipe._id}`);
    > 280 |       expect(res.body.data.title).toBe('Updated Title');
          |                            ^
      281 |     });
      282 |
      283 |     test('should clear cache on recipe deletion', async () => {

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:280:28)

  â— V1.1 Features Integration Tests â€º Caching â€º should clear cache on recipe deletion

    TypeError: Cannot read properties of undefined (reading 'length')

      296 |       // Get list again
      297 |       const res = await request(app).get('/api/recipes');
    > 298 |       expect(res.body.data.length).toBe(0);
          |                            ^
      299 |     });
      300 |   });
      301 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:298:28)

  â— V1.1 Features Integration Tests â€º Lock Recipe Feature â€º should toggle recipe lock status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      310 |       // Lock the recipe
      311 |       const lockRes = await request(app).put(`/api/recipes/${recipe._id}/lock`);
    > 312 |       expect(lockRes.status).toBe(200);
          |                              ^
      313 |       expect(lockRes.body.data.isLocked).toBe(true);
      314 |
      315 |       // Unlock the recipe

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:312:30)

  â— V1.1 Features Integration Tests â€º Lock Recipe Feature â€º should prevent deletion of locked recipe

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

      329 |       const res = await request(app).delete(`/api/recipes/${recipe._id}`);
      330 |       
    > 331 |       expect(res.status).toBe(403);
          |                          ^
      332 |       expect(res.body.success).toBe(false);
      333 |       expect(res.body.error).toContain('locked');
      334 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:331:26)

  â— V1.1 Features Integration Tests â€º Lock Recipe Feature â€º should allow deletion of unlocked recipe

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      348 |       const res = await request(app).delete(`/api/recipes/${recipe._id}`);
      349 |       
    > 350 |       expect(res.status).toBe(200);
          |                          ^
      351 |       expect(res.body.success).toBe(true);
      352 |
      353 |       // Verify recipe is deleted

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:350:26)

  â— V1.1 Features Integration Tests â€º Error Handling â€º should return 404 for non-existent recipe

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

      362 |       const res = await request(app).get(`/api/recipes/${fakeId}`);
      363 |
    > 364 |       expect(res.status).toBe(404);
          |                          ^
      365 |       expect(res.body.success).toBe(false);
      366 |     });
      367 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:364:26)

  â— V1.1 Features Integration Tests â€º Error Handling â€º should handle invalid MongoDB ID format

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 401

      369 |       const res = await request(app).get('/api/recipes/invalid-id');
      370 |
    > 371 |       expect(res.status).toBe(500);
          |                          ^
      372 |       expect(res.body.success).toBe(false);
      373 |     });
      374 |

      at Object.<anonymous> (src/__tests__/integration/v1.1-features.test.js:371:26)

(node:69131) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
2026-02-17 11:41:09.955 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/auth/login:::ffff:127.0.0.1"}
2026-02-17 11:41:10.040 [[32minfo[39m]: POST /login 200 85ms {"requestId":"127849d9-fe22-45de-b279-082def117722","method":"POST","path":"/login","url":"/api/auth/login","statusCode":200,"duration":85,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":718}
2026-02-17 11:41:10.052 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/dropbox/auth:::ffff:127.0.0.1"}
2026-02-17 11:41:10.056 [[32minfo[39m]: Dropbox OAuth initiated for user 69949a252efeed98c0381377
2026-02-17 11:41:10.058 [[32minfo[39m]: GET /dropbox/auth 200 6ms {"requestId":"8aeffc3e-5a05-4689-926f-dbba67a1604d","method":"GET","path":"/dropbox/auth","url":"/api/cloud/dropbox/auth","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":255}
2026-02-17 11:41:10.068 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/dropbox/auth:::ffff:127.0.0.1"}
2026-02-17 11:41:10.070 [[33mwarn[39m]: GET /dropbox/auth 401 1ms {"requestId":"368c9ca4-3a6a-4d31-9bac-69f3737178d8","method":"GET","path":"/dropbox/auth","url":"/api/cloud/dropbox/auth","statusCode":401,"duration":1,"ip":"::ffff:127.0.0.1","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":84}
2026-02-17 11:41:10.076 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/status:::ffff:127.0.0.1"}
2026-02-17 11:41:10.081 [[32minfo[39m]: GET /status 200 5ms {"requestId":"b6a2d703-4d7f-4c64-a62b-a7c530a9feae","method":"GET","path":"/status","url":"/api/cloud/status","statusCode":200,"duration":5,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":50}
2026-02-17 11:41:10.093 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/status:::ffff:127.0.0.1"}
2026-02-17 11:41:10.097 [[32minfo[39m]: GET /status 200 4ms {"requestId":"15776af0-0b05-4e70-bd81-ba701d76b2f2","method":"GET","path":"/status","url":"/api/cloud/status","statusCode":200,"duration":4,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":427}
2026-02-17 11:41:10.105 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.117 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.117 [[32minfo[39m]: POST /disconnect 200 12ms {"requestId":"f1edf791-70c9-4adf-8809-1661fe380728","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":12,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.127 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.139 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.139 [[32minfo[39m]: POST /disconnect 200 12ms {"requestId":"6c6becad-328f-4f83-9f60-c0f1c6f081cc","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":12,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.142 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.145 [[33mwarn[39m]: POST /disconnect 400 3ms {"requestId":"3c903284-2b82-4c13-8c6e-5bee91714061","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:41:10.152 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:10.155 [[32minfo[39m]: Manual backup requested for user 69949a252efeed98c0381377
2026-02-17 11:41:10.156 [[32minfo[39m]: Generating manual backup for user 69949a252efeed98c0381377
2026-02-17 11:41:10.196 [[32minfo[39m]: Archive created: 292 bytes
2026-02-17 11:41:10.196 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-41-10.zip (292 bytes)
2026-02-17 11:41:10.205 [[32minfo[39m]: Cleaned up backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-41-10.zip
2026-02-17 11:41:10.205 [[32minfo[39m]: Manual backup successful for user 69949a252efeed98c0381377: recipe-book-manual-backup-2026-02-16T15-00-00.zip
2026-02-17 11:41:10.206 [[32minfo[39m]: POST /backup 200 54ms {"requestId":"2fb767a7-cdd5-4bcd-be52-1912550525b5","method":"POST","path":"/backup","url":"/api/cloud/backup","statusCode":200,"duration":54,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":315}
2026-02-17 11:41:10.217 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.226 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.226 [[32minfo[39m]: POST /disconnect 200 9ms {"requestId":"3143c608-e3bc-4024-83b9-1435dfdf506a","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":9,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.227 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backup:::ffff:127.0.0.1"}
2026-02-17 11:41:10.230 [[33mwarn[39m]: POST /backup 400 3ms {"requestId":"4dc98a8f-1b81-43f1-94e4-dc7456e54771","method":"POST","path":"/backup","url":"/api/cloud/backup","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":104}
2026-02-17 11:41:10.237 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.245 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.245 [[32minfo[39m]: POST /disconnect 200 8ms {"requestId":"51842172-9578-4096-86f8-e699e95e98cf","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":8,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.246 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups:::ffff:127.0.0.1"}
2026-02-17 11:41:10.249 [[32minfo[39m]: GET /backups 200 3ms {"requestId":"fd329b36-278a-4b9d-8aa5-847aeb5cfe2e","method":"GET","path":"/backups","url":"/api/cloud/backups","statusCode":200,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":39}
2026-02-17 11:41:10.257 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups:::ffff:127.0.0.1"}
2026-02-17 11:41:10.260 [[32minfo[39m]: GET /backups 200 3ms {"requestId":"0fd221c2-bfd4-4223-b81a-d0b10fb56d76","method":"GET","path":"/backups","url":"/api/cloud/backups?limit=5","statusCode":200,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","query":{"limit":"5"},"rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":354}
2026-02-17 11:41:10.276 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups/id:backup_1/preview:::ffff:127.0.0.1"}
2026-02-17 11:41:10.278 [[32minfo[39m]: Preview backup requested for user 69949a252efeed98c0381377: id:backup_1
2026-02-17 11:41:10.279 [[32minfo[39m]: Generating manual backup for user 69949a252efeed98c0381377
2026-02-17 11:41:10.292 [[32minfo[39m]: Archive created: 518 bytes
2026-02-17 11:41:10.292 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-41-10.zip (518 bytes)
2026-02-17 11:41:10.292 [[32minfo[39m]: Getting backup preview: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-41-10.zip
2026-02-17 11:41:10.293 [[32minfo[39m]: Parsing backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-41-10.zip
2026-02-17 11:41:10.307 [[32minfo[39m]: Backup parsed successfully: 2 recipes
2026-02-17 11:41:10.309 [[32minfo[39m]: GET /backups/id:backup_1/preview 200 33ms {"requestId":"d1150623-8366-49e8-8504-2c3e3ca43e0b","method":"GET","path":"/backups/id:backup_1/preview","url":"/api/cloud/backups/id:backup_1/preview","statusCode":200,"duration":33,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":193}
2026-02-17 11:41:10.316 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.326 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.326 [[32minfo[39m]: POST /disconnect 200 10ms {"requestId":"88dffdb0-cf1c-494c-ab31-4b6671bdd00a","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":10,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.327 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/backups/id:backup_1/preview:::ffff:127.0.0.1"}
2026-02-17 11:41:10.330 [[33mwarn[39m]: GET /backups/id:backup_1/preview 400 3ms {"requestId":"1d21f2a0-da37-486c-a2f6-f56d09d6b529","method":"GET","path":"/backups/id:backup_1/preview","url":"/api/cloud/backups/id:backup_1/preview","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:41:10.350 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:41:10.415 [[32minfo[39m]: Restore requested for user 69949a252efeed98c0381377: backup=id:backup_1, mode=merge
2026-02-17 11:41:10.415 [[32minfo[39m]: Generating manual backup for user 69949a252efeed98c0381377
2026-02-17 11:41:10.421 [[32minfo[39m]: Archive created: 494 bytes
2026-02-17 11:41:10.421 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-41-10.zip (494 bytes)
2026-02-17 11:41:10.421 [[32minfo[39m]: Parsing backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-41-10.zip
2026-02-17 11:41:10.426 [[32minfo[39m]: Backup parsed successfully: 1 recipes
2026-02-17 11:41:10.427 [[32minfo[39m]: Starting restore for user 69949a252efeed98c0381377 {"mode":"merge","recipeCount":1}
2026-02-17 11:41:10.427 [[32minfo[39m]: Merge mode: Importing with duplicate checking for user 69949a252efeed98c0381377
2026-02-17 11:41:10.434 [[32minfo[39m]: Merge mode complete: 1 items imported, 0 skipped
2026-02-17 11:41:10.434 [[32minfo[39m]: Restore successful for user 69949a252efeed98c0381377 {"stats":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:41:10.434 [[32minfo[39m]: Restore successful for user 69949a252efeed98c0381377 {"statistics":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:41:10.434 [[32minfo[39m]: POST /restore 200 84ms {"requestId":"642c3578-a3d5-4cfd-bb44-60a22b8af73f","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":200,"duration":84,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":268}
2026-02-17 11:41:10.453 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:41:10.518 [[32minfo[39m]: Restore requested for user 69949a252efeed98c0381377: backup=id:backup_1, mode=replace
2026-02-17 11:41:10.518 [[32minfo[39m]: Generating manual backup for user 69949a252efeed98c0381377
2026-02-17 11:41:10.528 [[32minfo[39m]: Archive created: 494 bytes
2026-02-17 11:41:10.528 [[32minfo[39m]: Backup generated successfully: recipe-book-manual-backup-2026-02-17T16-41-10.zip (494 bytes)
2026-02-17 11:41:10.528 [[32minfo[39m]: Parsing backup file: /Users/scott.carroll/Development/copilot-testing/recipe-book/backend/temp/recipe-book-manual-backup-2026-02-17T16-41-10.zip
2026-02-17 11:41:10.537 [[32minfo[39m]: Backup parsed successfully: 1 recipes
2026-02-17 11:41:10.540 [[32minfo[39m]: Starting restore for user 69949a252efeed98c0381377 {"mode":"replace","recipeCount":1}
2026-02-17 11:41:10.540 [[32minfo[39m]: Replace mode: Deleting existing data for user 69949a252efeed98c0381377
2026-02-17 11:41:10.545 [[32minfo[39m]: Existing data deleted for user 69949a252efeed98c0381377 {"recipes":1,"collections":0,"mealPlans":0,"shoppingLists":0}
2026-02-17 11:41:10.550 [[32minfo[39m]: Replace mode complete: 1 items imported
2026-02-17 11:41:10.550 [[32minfo[39m]: Restore successful for user 69949a252efeed98c0381377 {"stats":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:41:10.550 [[32minfo[39m]: Restore successful for user 69949a252efeed98c0381377 {"statistics":{"totalImported":1,"totalSkipped":0,"recipes":{"imported":1,"skipped":0},"collections":{"imported":0,"skipped":0},"mealPlans":{"imported":0,"skipped":0},"shoppingLists":{"imported":0,"skipped":0}}}
2026-02-17 11:41:10.550 [[32minfo[39m]: POST /restore 200 97ms {"requestId":"4f137d9f-c30f-444c-81fe-bacdefa5bba4","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":200,"duration":97,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":268}
2026-02-17 11:41:10.570 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:41:10.571 [[33mwarn[39m]: POST /restore 400 1ms {"requestId":"b4e2348e-3f32-411a-9d89-2ec9e6b6b7c6","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":96}
2026-02-17 11:41:10.587 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:41:10.588 [[33mwarn[39m]: POST /restore 400 1ms {"requestId":"8ff38124-da53-431e-877a-4e882642fee8","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":400,"duration":1,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":76}
2026-02-17 11:41:10.605 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:41:10.672 [[33mwarn[39m]: Invalid password for restore attempt by user 69949a252efeed98c0381377
2026-02-17 11:41:10.672 [[33mwarn[39m]: POST /restore 401 67ms {"requestId":"e7140a4d-8676-4801-b0e2-42803d8691ed","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":401,"duration":67,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":46}
2026-02-17 11:41:10.689 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.697 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.697 [[32minfo[39m]: POST /disconnect 200 8ms {"requestId":"b0e2e03c-7fdc-4065-9cd7-c3c5ff71f1c0","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":8,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.699 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/restore:::ffff:127.0.0.1"}
2026-02-17 11:41:10.702 [[33mwarn[39m]: POST /restore 400 3ms {"requestId":"2b4957f7-480b-45d3-b2dd-aec162e97d8c","method":"POST","path":"/restore","url":"/api/cloud/restore","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:41:10.713 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.720 [[32minfo[39m]: Schedule updated for user 69949a252efeed98c0381377: enabled=true, frequency=daily
2026-02-17 11:41:10.721 [[32minfo[39m]: PUT /schedule 200 8ms {"requestId":"f76d1f23-42bc-4309-ba9d-135ac26979af","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":8,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":208}
2026-02-17 11:41:10.727 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.733 [[32minfo[39m]: Schedule updated for user 69949a252efeed98c0381377: enabled=true, frequency=weekly
2026-02-17 11:41:10.733 [[32minfo[39m]: PUT /schedule 200 6ms {"requestId":"c2ad6ec1-c1e2-430b-93d7-381618fc86e9","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":196}
2026-02-17 11:41:10.740 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.747 [[32minfo[39m]: Schedule updated for user 69949a252efeed98c0381377: enabled=false, frequency=undefined
2026-02-17 11:41:10.747 [[32minfo[39m]: PUT /schedule 200 7ms {"requestId":"24f1d296-bdb8-47f8-848c-a5f17e26d2b1","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":7,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:41:10.753 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.759 [[32minfo[39m]: Schedule updated for user 69949a252efeed98c0381377: enabled=undefined, frequency=invalid
2026-02-17 11:41:10.759 [[32minfo[39m]: PUT /schedule 200 6ms {"requestId":"0651092b-ac61-45cd-98c9-d0b15e4e5460","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":6,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:41:10.768 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.778 [[32minfo[39m]: Schedule updated for user 69949a252efeed98c0381377: enabled=undefined, frequency=undefined
2026-02-17 11:41:10.778 [[32minfo[39m]: PUT /schedule 200 10ms {"requestId":"e013da06-ff8c-4c6c-8280-f58966c36287","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":10,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:41:10.784 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.791 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.791 [[32minfo[39m]: POST /disconnect 200 7ms {"requestId":"9632719c-6fcf-48fc-81a6-cc5161582b82","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":7,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.792 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.795 [[33mwarn[39m]: PUT /schedule 400 3ms {"requestId":"59e10723-12b1-48da-aadb-ad6190d4ea00","method":"PUT","path":"/schedule","url":"/api/cloud/schedule","statusCode":400,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:41:10.800 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.802 [[32minfo[39m]: GET /schedule 200 2ms {"requestId":"f8ed0976-5e5f-4801-bd64-f06bcc4fc627","method":"GET","path":"/schedule","url":"/api/cloud/schedule","statusCode":200,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":175}
2026-02-17 11:41:10.807 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/disconnect:::ffff:127.0.0.1"}
2026-02-17 11:41:10.813 [[32minfo[39m]: dropbox disconnected for user 69949a252efeed98c0381377
2026-02-17 11:41:10.814 [[32minfo[39m]: POST /disconnect 200 7ms {"requestId":"3a2f1c2c-f85f-43dc-b60b-b7e61eea7f6c","method":"POST","path":"/disconnect","url":"/api/cloud/disconnect","statusCode":200,"duration":7,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":62}
2026-02-17 11:41:10.815 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/schedule:::ffff:127.0.0.1"}
2026-02-17 11:41:10.817 [[33mwarn[39m]: GET /schedule 400 2ms {"requestId":"9a34109f-d49b-4ab4-aa69-60f2fcf3209f","method":"GET","path":"/schedule","url":"/api/cloud/schedule","statusCode":400,"duration":2,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":57}
2026-02-17 11:41:10.827 [[33mwarn[39m]: Redis not available for rate limiting {"key":"recipe-book:ratelimit:/cloud/status:::ffff:127.0.0.1"}
2026-02-17 11:41:10.830 [[32minfo[39m]: GET /status 200 3ms {"requestId":"ec2e21bf-523c-4280-8c81-f376324aa3e5","method":"GET","path":"/status","url":"/api/cloud/status","statusCode":200,"duration":3,"ip":"::ffff:127.0.0.1","userId":"69949a252efeed98c0381377","rateLimit":{"remaining":300,"limit":300,"degraded":true},"responseSize":421}
PASS src/__tests__/integration/cloud-backup.test.js
  Cloud Backup API - OAuth Flow
    POST /api/cloud/dropbox/auth
      âœ“ should initiate Dropbox OAuth and return auth URL (18 ms)
      âœ“ should require authentication (8 ms)
    GET /api/cloud/status
      âœ“ should return not connected when no provider configured (12 ms)
      âœ“ should return connected status when provider configured (16 ms)
  Cloud Backup API - Provider Management
    POST /api/cloud/disconnect
      âœ“ should disconnect cloud provider (21 ms)
      âœ“ should fail when no provider connected (26 ms)
  Cloud Backup API - Backup Operations
    POST /api/cloud/backup
      âœ“ should create and upload manual backup successfully (63 ms)
      âœ“ should require cloud provider connection (22 ms)
    GET /api/cloud/backups
      âœ“ should return empty array when no provider connected (19 ms)
      âœ“ should accept limit parameter (11 ms)
    GET /api/cloud/backups/:backupId/preview
      âœ“ should preview backup contents (48 ms)
      âœ“ should require cloud provider connection (20 ms)
    POST /api/cloud/restore
      âœ“ should restore backup in merge mode (111 ms)
      âœ“ should restore backup in replace mode (117 ms)
      âœ“ should validate required fields (17 ms)
      âœ“ should validate mode parameter (18 ms)
      âœ“ should reject invalid password (87 ms)
      âœ“ should require cloud provider connection (27 ms)
  Cloud Backup API - Schedule Management
    PUT /api/cloud/schedule
      âœ“ should update schedule settings (14 ms)
      âœ“ should calculate next backup time when enabled (12 ms)
      âœ“ should clear next backup time when disabled (14 ms)
      âœ“ should validate frequency values (13 ms)
      âœ“ should validate time format (19 ms)
      âœ“ should require cloud provider connection (15 ms)
    GET /api/cloud/schedule
      âœ“ should return current schedule (7 ms)
      âœ“ should require cloud provider connection (16 ms)
  Token Encryption
    âœ“ should encrypt and decrypt tokens correctly
    âœ“ should use different IVs for same token (1 ms)
    âœ“ should throw error for empty strings (2 ms)
  Security - Token Protection
    âœ“ should not expose tokens in JSON response (9 ms)

PASS src/models/__tests__/Recipe.test.js
  Recipe Model (REQ-006)
    Schema Validation
      âœ“ should create a recipe with valid required fields (82 ms)
      âœ“ should fail when title is missing (9 ms)
      âœ“ should fail when ingredients are missing (7 ms)
      âœ“ should fail when instructions are missing (12 ms)
      âœ“ should require name in ingredient (11 ms)
    DishType Enum Validation
      âœ“ should accept valid dishType: Appetizer (25 ms)
      âœ“ should accept valid dishType: Main Course (3 ms)
      âœ“ should accept valid dishType: Side Dish (2 ms)
      âœ“ should accept valid dishType: Dessert (3 ms)
      âœ“ should accept valid dishType: Beverage (3 ms)
      âœ“ should accept valid dishType: Snack (14 ms)
      âœ“ should accept valid dishType: Breakfast (2 ms)
      âœ“ should accept valid dishType: Lunch (2 ms)
      âœ“ should accept valid dishType: Dinner (5 ms)
      âœ“ should accept valid dishType: Other (2 ms)
      âœ“ should reject invalid dishType (1 ms)
      âœ“ should default to "Other" when dishType not provided (4 ms)
    Numeric Field Validation
      âœ“ should accept valid prepTime (3 ms)
      âœ“ should reject negative prepTime (2 ms)
      âœ“ should reject negative cookTime (2 ms)
      âœ“ should accept valid servings (3 ms)
      âœ“ should reject servings below minimum (2 ms)
      âœ“ should accept valid rating within range (4 ms)
      âœ“ should reject rating below minimum (2 ms)
      âœ“ should reject rating above maximum (1 ms)
    Text Field Trimming
      âœ“ should trim title (2 ms)
      âœ“ should trim description (3 ms)
      âœ“ should trim cuisine (3 ms)
      âœ“ should trim sourceUrl (1 ms)
    Array Fields
      âœ“ should handle multiple ingredients (3 ms)
      âœ“ should handle multiple instructions (2 ms)
      âœ“ should handle tags array (2 ms)
    Timestamps
      âœ“ should automatically add createdAt timestamp (3 ms)
      âœ“ should automatically add updatedAt timestamp (2 ms)
      âœ“ should update updatedAt on modification (18 ms)
    Indexes
      âœ“ should have text index on title and description (2 ms)
      âœ“ should support text search on title (11 ms)
    Optional Fields
      âœ“ should allow recipe without description (3 ms)
      âœ“ should allow recipe without times (2 ms)
      âœ“ should allow recipe without rating (4 ms)
      âœ“ should allow recipe without sourceUrl (2 ms)
    Ingredient Schema
      âœ“ should allow ingredient with only name (2 ms)
      âœ“ should store ingredient with all fields (4 ms)
      âœ“ should not add _id to ingredients (3 ms)

PASS src/services/__tests__/scraper.test.js
  Scraper Service
    HTML Entity Decoding (REQ-005)
      âœ“ should decode common HTML entities (8 ms)
      âœ“ should decode numeric HTML entities (3 ms)
      âœ“ should decode hex HTML entities (1 ms)
    JSON-LD Recipe Extraction
      âœ“ should extract recipe from JSON-LD schema (2 ms)
      âœ“ should handle @graph wrapped JSON-LD
    Servings Extraction
      âœ“ should extract servings from recipeYield number (1 ms)
      âœ“ should extract servings from recipeYield string
      âœ“ should handle various servings formats (4 ms)
    DishType Mapping
      âœ“ should map recipeCategory to valid dishType enum (3 ms)
    Time Parsing
      âœ“ should parse ISO 8601 duration format (1 ms)
    Ingredient Cleaning
      âœ“ should remove duplicate ingredients
      âœ“ should filter out very short or very long ingredients (1 ms)
    Instruction Cleaning
      âœ“ should remove HTML tags from instructions (1 ms)
      âœ“ should remove URLs from instructions (1 ms)
      âœ“ should remove duplicate instructions
      âœ“ should filter out very short instructions (1 ms)
    Error Handling
      âœ“ should throw error on network failure (1 ms)
      âœ“ should throw error when title is missing (1 ms)
      âœ“ should handle timeout (124 ms)
    Source URL
      âœ“ should include source URL in result (1 ms)

Test Suites: 7 failed, 3 passed, 10 total
Tests:       105 failed, 132 passed, 237 total
Snapshots:   0 total
Time:        34.35 s, estimated 210 s
Ran all test suites.
âœ“ MongoDB Memory Server stopped
âœ“ All connections closed
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
