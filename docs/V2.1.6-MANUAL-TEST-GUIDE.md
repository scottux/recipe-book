# V2.1.6 Two-Factor Authentication - Manual Testing Guide

**Version**: 2.1.6  
**Feature**: Two-Factor Authentication (2FA)  
**Date**: February 16, 2026  
**Tester**: _____________  

---

## Pre-Testing Setup

### ✅ Servers Running
- **Backend**: http://localhost:5000 ✓
- **Frontend**: http://localhost:3001 ✓
- **Database**: MongoDB (via Docker or local)

### Required Tools
- **Authenticator App**: Install one of these on your phone:
  - Google Authenticator (iOS/Android)
  - Microsoft Authenticator (iOS/Android)
  - Authy (iOS/Android)
  - 1Password (if you use it)

### Test Account
- **Email**: test2fa@example.com
- **Password**: Test123!@#
- **Status**: Create fresh account for testing

---

## Test Plan Overview

We'll test the complete 2FA lifecycle:
1. ✅ Enable 2FA (Setup & Verification)
2. ✅ Login with 2FA
3. ✅ Backup code usage
4. ✅ Disable 2FA
5. ✅ Edge cases and error handling

---

## Test Suite 1: Enable Two-Factor Authentication

### Test 1.1: Account Registration
**Objective**: Create a fresh test account

**Steps**:
1. Open http://localhost:3001
2. Click "Register" or navigate to `/register`
3. Fill in registration form:
   - Display Name: "2FA Test User"
   - Email: test2fa@example.com
   - Password: Test123!@#
4. Click "Register"

**Expected Results**:
- [ ] Registration successful
- [ ] Redirected to home/recipes page
- [ ] User logged in automatically

**Actual Results**:
```
[Record what actually happened]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 1.2: Navigate to Account Settings
**Objective**: Access 2FA setup

**Steps**:
1. Click user menu (top-right)
2. Click "Account Settings"
3. Scroll to "Two-Factor Authentication" section

**Expected Results**:
- [ ] Account Settings page loads
- [ ] 2FA section visible
- [ ] Shows "2FA Status: Disabled"
- [ ] "Enable Two-Factor Authentication" button visible

**Actual Results**:
```
[Record what actually happened]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 1.3: Initiate 2FA Setup
**Objective**: Generate QR code and secret

**Steps**:
1. Click "Enable Two-Factor Authentication" button
2. Should navigate to `/2fa/setup`

**Expected Results**:
- [ ] Navigates to 2FA setup page
- [ ] QR code displayed
- [ ] Manual entry code displayed
- [ ] Instructions visible
- [ ] "I've scanned the QR code" or similar button

**Visual Check**:
- [ ] QR code is clear and scannable
- [ ] Manual entry code is formatted properly (BASE32)
- [ ] Cookbook brown theme applied
- [ ] Instructions are clear

**Actual Results**:
```
[Record what actually happened]
Screenshot: [Optional]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 1.4: Scan QR Code
**Objective**: Add account to authenticator app

**Steps**:
1. Open authenticator app on phone
2. Tap "Add account" or "+"
3. Choose "Scan QR code"
4. Scan the QR code displayed on screen

**Expected Results**:
- [ ] QR code scans successfully
- [ ] Account added: "Recipe Book (test2fa@example.com)"
- [ ] 6-digit code appears and refreshes every 30 seconds

**Alternative (Manual Entry)**:
1. Click "Can't scan? Enter code manually"
2. In authenticator app, choose "Enter key manually"
3. Enter the manual entry code
4. Select "Time-based"

**Actual Results**:
```
[Record authenticator app name and result]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 1.5: Verify 2FA Code (Enable 2FA)
**Objective**: Complete 2FA setup

**Steps**:
1. Click "Next" or "Verify" button on setup page
2. Should navigate to `/2fa/verify`
3. Enter the 6-digit code from authenticator app
4. Click "Verify and Enable 2FA"

**Expected Results**:
- [ ] Code accepted
- [ ] Success message displayed
- [ ] Backup codes displayed (10 codes)
- [ ] Codes are 8 characters each (e.g., "A1B2C3D4")
- [ ] Clear instructions to save backup codes
- [ ] "I've saved my backup codes" confirmation

**Security Check**:
- [ ] Backup codes are unique
- [ ] Each code is properly formatted
- [ ] Warning about saving codes is prominent

**Actual Results**:
```
[Record backup codes for later testing]
Backup Code 1: ___________
Backup Code 2: ___________
[remaining codes...]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 1.6: Confirm 2FA Status
**Objective**: Verify 2FA is enabled

**Steps**:
1. After saving backup codes, navigate back to Account Settings
2. Check 2FA section

**Expected Results**:
- [ ] Shows "2FA Status: Enabled" ✓
- [ ] "Disable Two-Factor Authentication" button visible
- [ ] Green checkmark or success indicator
- [ ] No "Enable" button visible

**Actual Results**:
```
[Record status display]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

## Test Suite 2: Login with Two-Factor Authentication

### Test 2.1: Logout
**Objective**: Test fresh login

**Steps**:
1. Click user menu
2. Click "Logout"

**Expected Results**:
- [ ] User logged out
- [ ] Redirected to login page
- [ ] Session cleared

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 2.2: Login - Step 1 (Credentials)
**Objective**: Test initial login with 2FA account

**Steps**:
1. On login page, enter:
   - Email: test2fa@example.com
   - Password: Test123!@#
2. Click "Login"

**Expected Results**:
- [ ] Credentials accepted
- [ ] NOT logged in yet
- [ ] Message: "Two-factor authentication required" or similar
- [ ] Redirected to 2FA verification page
- [ ] 6-digit code input field displayed

**Critical Check**:
- [ ] User should NOT have access to app yet
- [ ] No access token in localStorage

**Actual Results**:
```
[Record the flow]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 2.3: Login - Step 2 (Invalid 2FA Code)
**Objective**: Test error handling

**Steps**:
1. Enter incorrect code: 000000
2. Click "Verify"

**Expected Results**:
- [ ] Error message: "Invalid 2FA code" or similar
- [ ] Not logged in
- [ ] Can retry with different code
- [ ] No system crash

**Actual Results**:
```
[Record error message]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 2.4: Login - Step 2 (Valid 2FA Code)
**Objective**: Complete 2FA login

**Steps**:
1. Get current code from authenticator app
2. Enter the 6-digit code
3. Click "Verify"

**Expected Results**:
- [ ] Code accepted
- [ ] User logged in successfully
- [ ] Redirected to home/recipes page
- [ ] Access token in localStorage
- [ ] User session established

**Actual Results**:
```
[Record success]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

## Test Suite 3: Backup Code Testing

### Test 3.1: Logout Again
**Objective**: Prepare for backup code test

**Steps**:
1. Logout from the application

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 3.2: Login with Backup Code
**Objective**: Test backup code as alternative

**Steps**:
1. Login with email/password
2. At 2FA verification screen, look for "Use backup code" option
3. Click "Use backup code" (if available) or enter backup code directly
4. Enter one of the saved backup codes
5. Click "Verify"

**Expected Results**:
- [ ] Backup code accepted
- [ ] User logged in successfully
- [ ] Backup code marked as used (cannot be used again)

**Actual Results**:
```
[Record which backup code was used]
Used: Backup Code #___
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 3.3: Attempt to Reuse Backup Code
**Objective**: Verify single-use enforcement

**Steps**:
1. Logout
2. Login with email/password
3. Try to use the SAME backup code again
4. Click "Verify"

**Expected Results**:
- [ ] Error message: "Invalid 2FA code" or "Backup code already used"
- [ ] Login rejected
- [ ] Cannot authenticate with used code

**Actual Results**:
```
[Record error message]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

## Test Suite 4: Disable Two-Factor Authentication

### Test 4.1: Login with TOTP
**Objective**: Get authenticated to disable 2FA

**Steps**:
1. Login with email/password
2. Use authenticator app code (not backup code)
3. Complete login

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 4.2: Navigate to Account Settings
**Objective**: Access disable function

**Steps**:
1. Go to Account Settings
2. Scroll to 2FA section

**Expected Results**:
- [ ] "2FA Status: Enabled"
- [ ] "Disable Two-Factor Authentication" button visible

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 4.3: Disable 2FA (Invalid Password)
**Objective**: Test security validation

**Steps**:
1. Click "Disable Two-Factor Authentication"
2. When prompted, enter WRONG password: "WrongPassword123!"
3. Click "Disable" or "Confirm"

**Expected Results**:
- [ ] Error message: "Invalid password" or similar
- [ ] 2FA still enabled
- [ ] Cannot disable without correct password

**Actual Results**:
```
[Record error message]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 4.4: Disable 2FA (Valid Password)
**Objective**: Successfully disable 2FA

**Steps**:
1. Click "Disable Two-Factor Authentication" again
2. Enter CORRECT password: Test123!@#
3. Click "Disable" or "Confirm"

**Expected Results**:
- [ ] Success message: "2FA has been disabled" or similar
- [ ] Status updates to "2FA Status: Disabled"
- [ ] "Enable Two-Factor Authentication" button visible
- [ ] 2FA secret and backup codes removed from database

**Actual Results**:
```
[Record success message]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 4.5: Verify Normal Login
**Objective**: Confirm 2FA is fully disabled

**Steps**:
1. Logout
2. Login with email/password ONLY
3. Click "Login"

**Expected Results**:
- [ ] Logged in immediately
- [ ] NO 2FA verification required
- [ ] Redirected directly to app
- [ ] Normal login flow restored

**Actual Results**:
```
[Record login flow]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

## Test Suite 5: Edge Cases & Error Handling

### Test 5.1: Expired TOTP Code
**Objective**: Test time-sensitive code handling

**Steps**:
1. Enable 2FA again
2. Logout
3. Login with email/password
4. Get authenticator code
5. Wait 30+ seconds for code to expire
6. Enter the EXPIRED code
7. Click "Verify"

**Expected Results**:
- [ ] Error message: "Invalid 2FA code"
- [ ] Can retry with new code

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 5.2: Network Error Handling
**Objective**: Test error states

**Steps**:
1. Stop backend server
2. Try to setup 2FA or login with 2FA
3. Observe error handling

**Expected Results**:
- [ ] Graceful error message
- [ ] No app crash
- [ ] Clear indication of problem

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 5.3: Rate Limiting
**Objective**: Test brute force protection

**Steps**:
1. Attempt multiple failed 2FA verifications rapidly
2. Observe rate limiting behavior

**Expected Results**:
- [ ] Rate limiting kicks in after X failed attempts
- [ ] Clear error message about rate limit
- [ ] Cannot spam verification attempts

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

## Test Suite 6: UX & Design Review

### Test 6.1: Visual Design Compliance
**Objective**: Verify cookbook theme

**Checklist**:
- [ ] All buttons use cookbook brown theme
- [ ] No blue buttons or elements
- [ ] Typography uses cookbook fonts
- [ ] Borders use aged paper style
- [ ] Colors match design system
- [ ] Shadows use cookbook shadows

**Non-Compliant Elements**:
```
[List any theme violations]
```

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 6.2: Mobile Responsiveness
**Objective**: Test on mobile viewport

**Steps**:
1. Resize browser to mobile width (375px)
2. Test entire 2FA flow on mobile size

**Expected Results**:
- [ ] QR code displays properly
- [ ] All text readable
- [ ] Buttons accessible
- [ ] No horizontal scroll
- [ ] Touch targets 44x44px minimum

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

### Test 6.3: Accessibility
**Objective**: Basic a11y compliance

**Checklist**:
- [ ] Keyboard navigation works
- [ ] Focus states visible
- [ ] Form labels properly associated
- [ ] Error messages announced
- [ ] Sufficient color contrast

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

## Test Suite 7: Backend API Validation

### Test 7.1: Direct API Testing

**Use curl or Postman to test endpoints directly**:

```bash
# 1. Register user
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"displayName":"API Test","email":"apitest@example.com","password":"Test123!@#"}'

# 2. Setup 2FA (requires auth token from registration)
curl -X POST http://localhost:5000/api/auth/2fa/setup \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# 3. Check 2FA status
curl -X GET http://localhost:5000/api/auth/2fa/status \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Expected Results**:
- [ ] All endpoints return proper status codes
- [ ] Response format matches API contract
- [ ] Error handling works

**Status**: ⬜ PASS / ⬜ FAIL / ⬜ SKIP

---

## Summary & Sign-Off

### Test Execution Summary

**Total Tests**: 22  
**Passed**: ___  
**Failed**: ___  
**Skipped**: ___  
**Pass Rate**: ____%

### Critical Bugs Found
```
[List any critical bugs that block release]
1. 
2. 
```

### Minor Issues Found
```
[List non-blocking issues for future fix]
1. 
2. 
```

### UX Improvements Suggested
```
[List UX enhancements]
1. 
2. 
```

### Overall Assessment
⬜ **READY FOR PRODUCTION** - All critical paths work  
⬜ **NEEDS MINOR FIXES** - Some issues but core works  
⬜ **NEEDS MAJOR FIXES** - Critical functionality broken  
⬜ **BLOCKED** - Cannot proceed with testing

### Tester Sign-Off

**Tester Name**: _________________  
**Date**: _________________  
**Time Spent**: _________ hours  
**Recommendation**: _________________

---

## Next Steps

Based on test results:

1. ✅ If all tests pass → Proceed to **Phase 6: UX Review**
2. ⚠️ If minor issues → Document and proceed with caution
3. ❌ If critical issues → Return to **Phase 3: Development** for fixes

---

**Document Version**: 1.0  
**Last Updated**: February 16, 2026  
**Related Documents**:
- REQ-020-two-factor-auth.md
- docs/SDLC.md Phase 5 (Testing)